<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Benton Lane â€” Product Pipeline</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --brown:       #332b1e;
    --brown-mid:   #4a3d2b;
    --brown-light: #6b5a42;
    --charcoal:    #3d3d3d;
    --charcoal-lt: #5a5a5a;
    --cream:       #f0ece4;
    --cream-dk:    #e0d8cc;
    --warm-white:  #faf8f5;
    --rule:        #c8bfb0;
    --body:        #2a2520;
    --success:     #4a7c59;
    --warning:     #b5762a;
    --muted:       #9e9790;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--warm-white);
    color: var(--body);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .sidebar {
    position: fixed;
    left: 0; top: 0; bottom: 0;
    width: 220px;
    background: var(--brown);
    display: flex;
    flex-direction: column;
    z-index: 100;
    transition: width 0.3s ease;
  }

  .sidebar-logo {
    padding: 28px 24px 24px;
    border-bottom: 1px solid rgba(200,191,176,0.15);
  }

  .sidebar-logo .wordmark {
    font-family: 'Cormorant Garamond', serif;
    font-size: 20px;
    font-weight: 700;
    color: #fff;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .sidebar-logo .tagline {
    font-size: 10px;
    color: var(--rule);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-top: 4px;
  }

  .sidebar-nav {
    flex: 1;
    padding: 16px 0;
  }

  .nav-section {
    padding: 8px 16px 4px;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: rgba(200,191,176,0.5);
    font-weight: 500;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 20px;
    color: rgba(240,236,228,0.7);
    font-size: 13px;
    font-weight: 400;
    cursor: pointer;
    transition: all 0.15s;
    border-left: 3px solid transparent;
    margin: 1px 0;
  }

  .nav-item:hover {
    color: #fff;
    background: rgba(255,255,255,0.06);
  }

  .nav-item.active {
    color: #fff;
    background: rgba(255,255,255,0.1);
    border-left-color: var(--rule);
  }

  .nav-item .icon {
    width: 16px;
    text-align: center;
    font-size: 14px;
    opacity: 0.8;
  }

  .nav-badge {
    margin-left: auto;
    background: var(--brown-light);
    color: var(--cream);
    font-size: 10px;
    padding: 1px 7px;
    border-radius: 10px;
    font-weight: 600;
  }

  .sidebar-footer {
    padding: 16px 20px;
    border-top: 1px solid rgba(200,191,176,0.15);
  }

  .user-chip {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--brown-mid);
    border: 2px solid var(--rule);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 600;
    color: var(--cream);
    flex-shrink: 0;
  }

  .user-info .name {
    font-size: 12px;
    color: #fff;
    font-weight: 500;
  }

  .user-info .role {
    font-size: 10px;
    color: var(--rule);
  }

  /* â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .main {
    margin-left: 220px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .topbar {
    background: #fff;
    border-bottom: 1px solid var(--cream-dk);
    padding: 0 32px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 50;
  }

  .topbar-left h1 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 22px;
    font-weight: 600;
    color: var(--brown);
  }

  .topbar-left .breadcrumb {
    font-size: 11px;
    color: var(--muted);
    margin-top: 1px;
  }

  .topbar-right {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.15s;
    font-family: 'DM Sans', sans-serif;
  }

  .btn-primary {
    background: var(--brown);
    color: #fff;
  }

  .btn-primary:hover { background: var(--brown-mid); }

  .btn-secondary {
    background: var(--cream);
    color: var(--brown);
    border: 1px solid var(--cream-dk);
  }

  .btn-secondary:hover { background: var(--cream-dk); }

  .notif-btn {
    width: 36px; height: 36px;
    border-radius: 8px;
    background: var(--cream);
    border: 1px solid var(--cream-dk);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    position: relative;
    font-size: 16px;
  }

  .notif-dot {
    position: absolute;
    top: 6px; right: 6px;
    width: 8px; height: 8px;
    background: var(--warning);
    border-radius: 50%;
    border: 2px solid #fff;
  }

  /* â”€â”€ PAGE CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .page { padding: 32px; display: none; animation: fadeIn 0.2s ease; }
  .page.active { display: block; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

  /* â”€â”€ STATS ROW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 28px;
  }

  .stat-card {
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 10px;
    padding: 20px 22px;
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: var(--brown);
  }

  .stat-card.accent::before { background: var(--charcoal); }
  .stat-card.success::before { background: var(--success); }
  .stat-card.warning::before { background: var(--warning); }

  .stat-label {
    font-size: 11px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--muted);
    font-weight: 500;
    margin-bottom: 8px;
  }

  .stat-value {
    font-family: 'Cormorant Garamond', serif;
    font-size: 36px;
    font-weight: 700;
    color: var(--brown);
    line-height: 1;
  }

  .stat-sub {
    font-size: 11px;
    color: var(--muted);
    margin-top: 6px;
  }

  .stat-sub span { color: var(--success); font-weight: 600; }
  .stat-sub span.warn { color: var(--warning); }

  /* â”€â”€ PIPELINE BOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .pipeline-board {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 14px;
    margin-bottom: 28px;
  }

  .pipeline-col {
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 10px;
    overflow: hidden;
  }

  .pipeline-col-header {
    padding: 12px 14px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .pipeline-col:nth-child(1) .pipeline-col-header { background: var(--brown); }
  .pipeline-col:nth-child(2) .pipeline-col-header { background: var(--brown-mid); }
  .pipeline-col:nth-child(3) .pipeline-col-header { background: var(--brown-light); }
  .pipeline-col:nth-child(4) .pipeline-col-header { background: var(--charcoal); }
  .pipeline-col:nth-child(5) .pipeline-col-header { background: var(--success); }

  .pipeline-col-title {
    font-size: 11px;
    font-weight: 600;
    color: #fff;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .pipeline-col-count {
    background: rgba(255,255,255,0.2);
    color: #fff;
    font-size: 11px;
    font-weight: 700;
    padding: 1px 8px;
    border-radius: 10px;
  }

  .pipeline-col-body {
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    min-height: 120px;
  }

  .pipeline-card {
    background: var(--warm-white);
    border: 1px solid var(--cream-dk);
    border-radius: 8px;
    padding: 12px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .pipeline-card:hover {
    border-color: var(--brown-light);
    box-shadow: 0 2px 8px rgba(51,43,30,0.08);
    transform: translateY(-1px);
  }

  .card-tag {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 2px 7px;
    border-radius: 4px;
    margin-bottom: 6px;
  }

  .tag-metal { background: rgba(51,43,30,0.1); color: var(--brown); }
  .tag-print { background: rgba(61,61,61,0.1); color: var(--charcoal); }
  .tag-both  { background: rgba(74,124,89,0.1); color: var(--success); }

  .card-title {
    font-size: 13px;
    font-weight: 500;
    color: var(--body);
    margin-bottom: 4px;
    line-height: 1.3;
  }

  .card-brand {
    font-size: 11px;
    color: var(--muted);
    font-style: italic;
  }

  .card-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 10px;
    padding-top: 8px;
    border-top: 1px solid var(--cream-dk);
  }

  .card-days {
    font-size: 10px;
    color: var(--muted);
  }

  .card-days.overdue { color: var(--warning); font-weight: 600; }

  .card-avatars {
    display: flex;
    gap: -4px;
  }

  .mini-avatar {
    width: 20px; height: 20px;
    border-radius: 50%;
    font-size: 9px;
    font-weight: 700;
    display: flex; align-items: center; justify-content: center;
    border: 2px solid #fff;
    color: #fff;
  }

  /* â”€â”€ SECTION HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .section-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 20px;
    font-weight: 600;
    color: var(--brown);
  }

  .section-sub {
    font-size: 12px;
    color: var(--muted);
    margin-top: 2px;
  }

  /* â”€â”€ TWO COL LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

  /* â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .card {
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 10px;
    overflow: hidden;
  }

  .card-head {
    padding: 16px 20px;
    border-bottom: 1px solid var(--cream-dk);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .card-head-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--brown);
  }

  .card-body { padding: 16px 20px; }

  /* â”€â”€ ACTIVITY FEED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .activity-item {
    display: flex;
    gap: 12px;
    padding: 12px 0;
    border-bottom: 1px solid var(--cream-dk);
  }

  .activity-item:last-child { border-bottom: none; }

  .activity-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--brown);
    margin-top: 5px;
    flex-shrink: 0;
  }

  .activity-dot.green { background: var(--success); }
  .activity-dot.orange { background: var(--warning); }

  .activity-text { font-size: 13px; color: var(--body); line-height: 1.4; }
  .activity-text strong { color: var(--brown); font-weight: 600; }
  .activity-time { font-size: 11px; color: var(--muted); margin-top: 2px; }

  /* â”€â”€ CAPACITY BARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .capacity-item {
    margin-bottom: 16px;
  }

  .capacity-label {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    margin-bottom: 6px;
  }

  .capacity-label span:last-child { color: var(--muted); }

  .capacity-track {
    height: 8px;
    background: var(--cream-dk);
    border-radius: 4px;
    overflow: hidden;
  }

  .capacity-fill {
    height: 100%;
    border-radius: 4px;
    background: var(--brown);
    transition: width 0.6s ease;
  }

  .capacity-fill.warn { background: var(--warning); }
  .capacity-fill.ok   { background: var(--success); }

  /* â”€â”€ KPI GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .kpi-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

  .kpi-item {
    padding: 14px;
    background: var(--warm-white);
    border-radius: 8px;
    border: 1px solid var(--cream-dk);
  }

  .kpi-name { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 4px; }
  .kpi-val { font-family: 'Cormorant Garamond', serif; font-size: 26px; font-weight: 700; color: var(--brown); }
  .kpi-target { font-size: 10px; color: var(--muted); margin-top: 2px; }
  .kpi-target span { color: var(--success); font-weight: 600; }

  /* â”€â”€ SUBMIT FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .form-group { margin-bottom: 18px; }
  .form-label { font-size: 12px; font-weight: 600; color: var(--brown); margin-bottom: 6px; display: block; text-transform: uppercase; letter-spacing: 0.5px; }
  .form-input, .form-textarea, .form-select {
    width: 100%;
    padding: 10px 14px;
    border: 1px solid var(--cream-dk);
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    color: var(--body);
    background: var(--warm-white);
    transition: border-color 0.15s;
    outline: none;
  }
  .form-input:focus, .form-textarea:focus, .form-select:focus { border-color: var(--brown); }
  .form-textarea { resize: vertical; min-height: 90px; }

  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

  .submit-card {
    max-width: 700px;
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 10px;
    overflow: hidden;
  }

  .submit-card-head {
    background: var(--brown);
    padding: 20px 28px;
  }

  .submit-card-head h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 22px;
    font-weight: 600;
    color: #fff;
  }

  .submit-card-head p {
    font-size: 13px;
    color: var(--rule);
    margin-top: 4px;
  }

  .submit-card-body { padding: 28px; }

  /* â”€â”€ FEASIBILITY TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }

  .data-table th {
    padding: 10px 14px;
    background: var(--brown);
    color: #fff;
    font-weight: 600;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    text-align: left;
  }

  .data-table td {
    padding: 12px 14px;
    border-bottom: 1px solid var(--cream-dk);
    color: var(--body);
  }

  .data-table tr:last-child td { border-bottom: none; }
  .data-table tr:nth-child(even) td { background: var(--warm-white); }
  .data-table tr:hover td { background: var(--cream); cursor: pointer; }

  .status-pill {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
  }

  .pill-pending  { background: rgba(181,118,42,0.12); color: var(--warning); }
  .pill-approved { background: rgba(74,124,89,0.12); color: var(--success); }
  .pill-review   { background: rgba(51,43,30,0.1); color: var(--brown); }
  .pill-hold     { background: rgba(61,61,61,0.1); color: var(--charcoal); }

  /* â”€â”€ VAULT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .doc-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }

  .doc-card {
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 8px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .doc-card:hover {
    border-color: var(--brown-light);
    box-shadow: 0 2px 8px rgba(51,43,30,0.08);
  }

  .doc-icon {
    font-size: 28px;
    margin-bottom: 10px;
  }

  .doc-name { font-size: 13px; font-weight: 600; color: var(--body); margin-bottom: 4px; }
  .doc-meta { font-size: 11px; color: var(--muted); }
  .doc-tag {
    display: inline-block;
    margin-top: 8px;
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 4px;
    background: var(--cream);
    color: var(--brown);
    font-weight: 600;
  }

  /* â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(51,43,30,0.5);
    z-index: 200;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: #fff;
    border-radius: 12px;
    width: 520px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(51,43,30,0.2);
    animation: modalIn 0.2s ease;
  }

  @keyframes modalIn { from { opacity: 0; transform: scale(0.96) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

  .modal-head {
    padding: 24px 28px 18px;
    border-bottom: 1px solid var(--cream-dk);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .modal-head h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 20px;
    font-weight: 600;
    color: var(--brown);
  }

  .modal-close {
    cursor: pointer;
    font-size: 20px;
    color: var(--muted);
    line-height: 1;
    background: none;
    border: none;
  }

  .modal-body { padding: 20px 28px 28px; }

  .detail-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--cream-dk);
    font-size: 13px;
  }

  .detail-row:last-child { border-bottom: none; }
  .detail-row .label { color: var(--muted); }
  .detail-row .val { font-weight: 500; color: var(--body); }

  .comment-box {
    background: var(--warm-white);
    border: 1px solid var(--cream-dk);
    border-radius: 8px;
    padding: 14px;
    margin-top: 16px;
  }

  .comment-box-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--muted);
    font-weight: 600;
    margin-bottom: 8px;
  }

  .comment-text { font-size: 13px; color: var(--body); line-height: 1.5; }

  .modal-actions { display: flex; gap: 10px; margin-top: 20px; }

  /* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .toast {
    position: fixed;
    bottom: 28px;
    right: 28px;
    background: var(--brown);
    color: #fff;
    padding: 14px 20px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    z-index: 300;
    display: none;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* â”€â”€ TEAM CHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .team-strip {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 24px;
  }

  .team-chip {
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    border: 1.5px solid transparent;
    transition: all 0.15s;
  }

  .chip-all    { background: var(--brown); color: #fff; border-color: var(--brown); }
  .chip-vb     { background: rgba(61,61,61,0.08); color: var(--charcoal); border-color: transparent; }
  .chip-vb:hover, .chip-vb.active { background: var(--charcoal); color: #fff; border-color: var(--charcoal); }
  .chip-prod   { background: rgba(51,43,30,0.08); color: var(--brown); border-color: transparent; }
  .chip-prod:hover, .chip-prod.active { background: var(--brown); color: #fff; border-color: var(--brown); }

  /* â”€â”€ PROJECTS PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .project-list { display: flex; flex-direction: column; gap: 16px; }

  .project-card {
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 10px;
    overflow: hidden;
    transition: box-shadow 0.15s;
  }

  .project-card:hover { box-shadow: 0 2px 12px rgba(51,43,30,0.07); }

  .project-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 20px;
    cursor: pointer;
    user-select: none;
    border-bottom: 1px solid transparent;
    transition: border-color 0.15s;
  }

  .project-card-header.open { border-bottom-color: var(--cream-dk); }

  .project-card-header-left { display: flex; align-items: center; gap: 14px; }

  .project-color-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .project-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--brown);
  }

  .project-meta {
    font-size: 12px;
    color: var(--muted);
    margin-top: 2px;
  }

  .project-header-right { display: flex; align-items: center; gap: 12px; }

  .project-total {
    font-family: 'Cormorant Garamond', serif;
    font-size: 20px;
    font-weight: 700;
    color: var(--brown);
  }

  .project-total-label {
    font-size: 10px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    text-align: right;
  }

  .project-chevron {
    font-size: 12px;
    color: var(--muted);
    transition: transform 0.2s;
  }

  .project-chevron.open { transform: rotate(180deg); }

  .project-body { display: none; padding: 20px; }
  .project-body.open { display: block; }

  /* Tabs inside project */
  .proj-tabs {
    display: flex;
    gap: 0;
    border-bottom: 2px solid var(--cream-dk);
    margin-bottom: 20px;
  }

  .proj-tab {
    padding: 8px 18px;
    font-size: 12px;
    font-weight: 600;
    color: var(--muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    transition: all 0.15s;
    text-transform: uppercase;
    letter-spacing: 0.6px;
  }

  .proj-tab:hover { color: var(--brown); }
  .proj-tab.active { color: var(--brown); border-bottom-color: var(--brown); }

  .proj-tab-content { display: none; }
  .proj-tab-content.active { display: block; }

  /* Inline editable table */
  .proj-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }

  .proj-table th {
    padding: 9px 12px;
    background: var(--brown);
    color: #fff;
    font-weight: 600;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    text-align: left;
  }

  .proj-table th:first-child { border-radius: 6px 0 0 0; }
  .proj-table th:last-child { border-radius: 0 6px 0 0; }

  .proj-table td {
    padding: 0;
    border-bottom: 1px solid var(--cream-dk);
  }

  .proj-table tr:last-child td { border-bottom: none; }
  .proj-table tr:nth-child(even) td { background: var(--warm-white); }

  .proj-table td input, .proj-table td select {
    width: 100%;
    padding: 10px 12px;
    border: none;
    background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    color: var(--body);
    outline: none;
  }

  .proj-table td input:focus, .proj-table td select:focus {
    background: #fffdf9;
    box-shadow: inset 0 0 0 2px rgba(51,43,30,0.15);
  }

  .proj-table td.cost-cell input { font-weight: 600; color: var(--brown); }
  .proj-table td.action-cell {
    width: 40px;
    text-align: center;
    padding: 8px;
  }

  .del-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--muted);
    font-size: 16px;
    line-height: 1;
    transition: color 0.15s;
    padding: 4px 8px;
  }

  .del-btn:hover { color: #c0392b; }

  .add-row-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    margin-top: 10px;
    background: none;
    border: 1.5px dashed var(--cream-dk);
    border-radius: 6px;
    color: var(--muted);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    width: 100%;
    justify-content: center;
    transition: all 0.15s;
    font-family: 'DM Sans', sans-serif;
  }

  .add-row-btn:hover { border-color: var(--brown); color: var(--brown); background: var(--cream); }

  /* Cost summary bar */
  .cost-summary {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 20px;
    padding: 16px;
    background: var(--warm-white);
    border-radius: 8px;
    border: 1px solid var(--cream-dk);
  }

  .cost-summary-item { text-align: center; }
  .cost-summary-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 4px; }
  .cost-summary-val { font-family: 'Cormorant Garamond', serif; font-size: 22px; font-weight: 700; color: var(--brown); }
  .cost-summary-val.highlight { color: var(--success); }
  .cost-summary-val.warn { color: var(--warning); }

  /* Pricing calculator */
  .pricing-calc {
    background: var(--warm-white);
    border: 1px solid var(--cream-dk);
    border-radius: 8px;
    padding: 20px;
  }

  .calc-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--cream-dk);
    font-size: 13px;
  }

  .calc-row:last-child { border-bottom: none; }
  .calc-row label { color: var(--muted); }
  .calc-row .calc-input {
    width: 120px;
    padding: 6px 10px;
    border: 1px solid var(--cream-dk);
    border-radius: 5px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    text-align: right;
    background: #fff;
    color: var(--body);
    outline: none;
  }

  .calc-row .calc-input:focus { border-color: var(--brown); }
  .calc-result { font-weight: 700; color: var(--brown); font-size: 15px; }
  .calc-result.green { color: var(--success); }

  /* Notes area */
  .proj-notes {
    width: 100%;
    min-height: 100px;
    padding: 12px;
    border: 1px solid var(--cream-dk);
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    color: var(--body);
    background: var(--warm-white);
    resize: vertical;
    outline: none;
  }

  .proj-notes:focus { border-color: var(--brown); }

/* â”€â”€ OPS PERFORMANCE METRICS v2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .ops-control-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 22px;
    flex-wrap: wrap;
    gap: 12px;
  }
  .ops-view-tabs {
    display: flex;
    background: var(--cream);
    border: 1px solid var(--cream-dk);
    border-radius: 8px;
    padding: 3px;
    gap: 2px;
  }
  .ops-view-tab {
    padding: 6px 14px;
    border-radius: 6px;
    border: none;
    background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 500;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }
  .ops-view-tab:hover { color: var(--brown); }
  .ops-view-tab.active { background: var(--brown); color: #fff; box-shadow: 0 1px 4px rgba(51,43,30,0.2); }

  .ops-shop-filter {
    display: flex;
    background: var(--cream);
    border: 1px solid var(--cream-dk);
    border-radius: 8px;
    padding: 3px;
    gap: 2px;
  }
  .ops-filter-btn {
    padding: 5px 12px;
    border-radius: 5px;
    border: none;
    background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    font-weight: 500;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
  }
  .ops-filter-btn:hover { color: var(--brown); }
  .ops-filter-btn.active { background: #fff; color: var(--brown); box-shadow: 0 1px 3px rgba(0,0,0,0.08); font-weight: 600; }

  .ops-data-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 5px 12px;
    background: rgba(181,118,42,0.08);
    border: 1px solid rgba(181,118,42,0.25);
    border-radius: 20px;
    font-size: 11px;
    color: var(--warning);
    font-weight: 500;
  }
  .ops-data-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--warning);
    animation: pulse-dot 2s infinite;
  }
  @keyframes pulse-dot {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  /* KPI Strip */
  .ops-kpi-strip {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 12px;
    margin-bottom: 22px;
  }
  .ops-kpi-card {
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 10px;
    padding: 16px;
    position: relative;
    overflow: hidden;
  }
  .ops-kpi-card::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 3px;
  }
  .ops-kpi-card.k1::after { background: var(--brown); }
  .ops-kpi-card.k2::after { background: var(--charcoal); }
  .ops-kpi-card.k3::after { background: var(--success); }
  .ops-kpi-card.k4::after { background: var(--warning); }
  .ops-kpi-card.k5::after { background: #7b68ae; }
  .ops-kpi-card.k6::after { background: #2196a8; }
  .ops-kpi-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 6px; }
  .ops-kpi-val { font-family: 'Cormorant Garamond', serif; font-size: 26px; font-weight: 700; color: var(--brown); line-height: 1; }
  .ops-kpi-delta { font-size: 11px; margin-top: 4px; font-weight: 600; }
  .ops-kpi-delta.up { color: var(--success); }
  .ops-kpi-delta.down { color: var(--warning); }
  .ops-kpi-delta.neutral { color: var(--muted); }

  /* Chart grid */
  .ops-chart-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    gap: 16px;
    margin-bottom: 22px;
  }
  .ops-chart-card {
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 10px;
    padding: 20px;
    overflow: hidden;
  }
  .ops-chart-card.wide { grid-column: 1 / -1; }
  .ops-chart-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 16px;
  }
  .ops-chart-title { font-size: 14px; font-weight: 600; color: var(--brown); }
  .ops-chart-sub { font-size: 11px; color: var(--muted); margin-top: 2px; }
  .ops-metric-select {
    padding: 6px 10px;
    border: 1px solid var(--cream-dk);
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    color: var(--body);
    background: var(--warm-white);
    outline: none;
    cursor: pointer;
  }
  .ops-metric-select:focus { border-color: var(--brown); }
  .ops-line-chart-wrap { position: relative; width: 100%; }
  .ops-bar-chart-wrap { position: relative; width: 100%; }

  /* Target vs actual bars */
  .ops-tva-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    font-size: 12px;
  }
  .ops-tva-label { width: 110px; color: var(--body); font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-shrink: 0; }
  .ops-tva-track { flex: 1; height: 18px; background: var(--cream); border-radius: 4px; position: relative; overflow: hidden; }
  .ops-tva-target { position: absolute; top: 0; left: 0; height: 100%; background: var(--cream-dk); border-radius: 4px; }
  .ops-tva-actual { position: absolute; top: 2px; left: 0; height: 14px; border-radius: 3px; transition: width 0.6s ease; }
  .ops-tva-pct { width: 42px; text-align: right; font-weight: 700; font-size: 11px; flex-shrink: 0; }
  .ops-tva-pct.good { color: var(--success); }
  .ops-tva-pct.warn { color: var(--warning); }
  .ops-tva-pct.bad  { color: #c0392b; }

  /* Deep metrics grid */
  .ops-metrics-deep {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 22px;
  }
  .ops-deep-card {
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 10px;
    padding: 18px 20px;
  }
  .ops-deep-title {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--brown);
    margin-bottom: 14px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--cream-dk);
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .ops-deep-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 7px 0;
    border-bottom: 1px solid var(--cream-dk);
    font-size: 12px;
  }
  .ops-deep-row:last-child { border-bottom: none; }
  .ops-deep-label { color: var(--muted); }
  .ops-deep-val { font-weight: 600; color: var(--body); }
  .ops-deep-val.good { color: var(--success); }
  .ops-deep-val.warn { color: var(--warning); }
  .ops-deep-val.accent { font-family: 'Cormorant Garamond', serif; font-size: 16px; color: var(--brown); }

  /* History table */
  .ops-history-section {
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 10px;
    overflow: hidden;
  }
  .ops-history-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--cream-dk);
  }
  .ops-export-btn {
    padding: 6px 14px;
    border: 1px solid var(--cream-dk);
    border-radius: 6px;
    background: var(--warm-white);
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    color: var(--brown);
    cursor: pointer;
    font-weight: 500;
    transition: all 0.15s;
  }
  .ops-export-btn:hover { background: var(--cream-dk); }
  .ops-history-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }
  .ops-history-table th {
    padding: 9px 14px;
    background: var(--warm-white);
    color: var(--muted);
    font-weight: 600;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    text-align: left;
    border-bottom: 1px solid var(--cream-dk);
    white-space: nowrap;
  }
  .ops-history-table td {
    padding: 9px 14px;
    border-bottom: 1px solid var(--cream-dk);
    color: var(--body);
    white-space: nowrap;
  }
  .ops-history-table tr:last-child td { border-bottom: none; }
  .ops-history-table tr:hover td { background: var(--warm-white); }
  .ops-pct-pill {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: 700;
  }
  .ops-pct-pill.good { background: rgba(74,124,89,0.12); color: var(--success); }
  .ops-pct-pill.warn { background: rgba(181,118,42,0.12); color: var(--warning); }
  .ops-pct-pill.bad  { background: rgba(192,57,43,0.12); color: #c0392b; }
  .ops-shop-tag {
    display: inline-block;
    padding: 2px 7px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
  }
  .ops-shop-tag.metal { background: rgba(51,43,30,0.1); color: var(--brown); }
  .ops-shop-tag.print { background: rgba(61,61,61,0.1); color: var(--charcoal); }

  /* New project modal */
  .np-form { display: flex; flex-direction: column; gap: 14px; }
  .np-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

  /* â”€â”€ SUPPLIER PRICE COMPARISON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .price-compare-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 18px;
  }
  .price-compare-desc {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 18px;
    line-height: 1.5;
  }
  .price-compare-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
    margin-bottom: 16px;
  }
  .price-compare-table th {
    padding: 10px 14px;
    background: var(--brown);
    color: #fff;
    font-weight: 600;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    text-align: left;
  }
  .price-compare-table th:first-child { border-radius: 6px 0 0 0; }
  .price-compare-table th:last-child  { border-radius: 0 6px 0 0; }
  .price-compare-table td {
    padding: 0;
    border-bottom: 1px solid var(--cream-dk);
    vertical-align: middle;
  }
  .price-compare-table tr:last-child td { border-bottom: none; }
  .price-compare-table tr:nth-child(even) td { background: var(--warm-white); }
  .price-compare-table td input {
    width: 100%;
    padding: 10px 12px;
    border: none;
    background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    color: var(--body);
    outline: none;
  }
  .price-compare-table td input:focus {
    background: #fffdf9;
    box-shadow: inset 0 0 0 2px rgba(51,43,30,0.15);
  }
  .price-compare-table td.pc-num input {
    font-weight: 600;
    color: var(--brown);
    text-align: right;
  }
  .price-compare-table td.pc-action {
    width: 40px;
    text-align: center;
    padding: 8px;
  }
  .pc-winner-cell {
    padding: 8px 14px !important;
    text-align: center;
  }
  .winner-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  .winner-badge.gold  { background: rgba(181,118,42,0.15); color: var(--warning); border: 1px solid rgba(181,118,42,0.3); }
  .winner-badge.green { background: rgba(74,124,89,0.12);  color: var(--success); border: 1px solid rgba(74,124,89,0.3);  }
  .winner-badge.none  { background: var(--cream); color: var(--muted); border: 1px solid var(--cream-dk); font-weight: 400; }

  /* Category winner sections */
  .pc-category {
    margin-bottom: 28px;
  }
  .pc-category-title {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    color: var(--brown);
    margin-bottom: 10px;
    padding-bottom: 6px;
    border-bottom: 2px solid var(--cream-dk);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .pc-category-icon {
    width: 22px; height: 22px;
    border-radius: 50%;
    background: var(--brown);
    color: #fff;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    flex-shrink: 0;
  }

  /* Overall winner summary */
  .pc-summary {
    background: var(--warm-white);
    border: 1px solid var(--cream-dk);
    border-radius: 10px;
    padding: 20px;
    margin-top: 24px;
  }
  .pc-summary-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 18px;
    font-weight: 600;
    color: var(--brown);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .pc-summary-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 16px;
  }
  .pc-summary-item {
    background: #fff;
    border: 1px solid var(--cream-dk);
    border-radius: 8px;
    padding: 14px;
    text-align: center;
  }
  .pc-summary-cat  { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 6px; }
  .pc-summary-name { font-size: 14px; font-weight: 600; color: var(--brown); margin-bottom: 4px; }
  .pc-summary-val  { font-family: 'Cormorant Garamond', serif; font-size: 22px; font-weight: 700; color: var(--success); }
  .pc-summary-val.empty { color: var(--muted); font-size: 16px; }
  .pc-overall-winner {
    background: linear-gradient(135deg, rgba(51,43,30,0.04), rgba(74,124,89,0.06));
    border: 1.5px solid rgba(74,124,89,0.3);
    border-radius: 8px;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .pc-overall-label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
  .pc-overall-name  { font-family: 'Cormorant Garamond', serif; font-size: 24px; font-weight: 700; color: var(--brown); }
  .pc-overall-cost  { font-family: 'Cormorant Garamond', serif; font-size: 28px; font-weight: 700; color: var(--success); }
  .pc-overall-savings { font-size: 12px; color: var(--success); font-weight: 600; margin-top: 2px; }
  .pc-overall-savings.none { color: var(--muted); font-weight: 400; }
</style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="wordmark">Benton Lane</div>
    <div class="tagline">Product Pipeline</div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section">Overview</div>
    <div class="nav-item active" onclick="showPage('dashboard', this)">
      <span class="icon">â—ˆ</span> Dashboard
    </div>
    <div class="nav-item" onclick="showPage('pipeline', this)">
      <span class="icon">âŸ³</span> Pipeline Board
      <span class="nav-badge" id="pipeline-nav-badge">8</span>
    </div>

    <div class="nav-section">Venture Builder</div>
    <div class="nav-item" onclick="showPage('submit', this)">
      <span class="icon">ï¼‹</span> Submit Idea
    </div>
    <div class="nav-item" onclick="showPage('roadmap', this)">
      <span class="icon">â—·</span> Product Roadmap
    </div>

    <div class="nav-section">Production & R&D</div>
    <div class="nav-item" onclick="showPage('feasibility', this)">
      <span class="icon">âœ“</span> Feasibility Review
      <span class="nav-badge">3</span>
    </div>
    <div class="nav-item" onclick="showPage('prototypes', this)">
      <span class="icon">â—«</span> Prototype Tracker
    </div>
    <div class="nav-item" onclick="showPage('capacity', this)">
      <span class="icon">â–¦</span> Shop Capacity
    </div>
    <div class="nav-item" onclick="showPage('opsmetrics', this)">
      <span class="icon">ðŸ“Š</span> Ops Performance
    </div>

    <div class="nav-section">Shared</div>
    <div class="nav-item" onclick="showPage('projects', this)">
      <span class="icon">â—§</span> Projects
    </div>
    <div class="nav-item" onclick="showPage('vault', this)">
      <span class="icon">âŠŸ</span> Document Vault
    </div>
    <div class="nav-item" onclick="showPage('kpis', this)">
      <span class="icon">â†—</span> KPI Dashboard
    </div>
  </nav>
  <div class="sidebar-footer">
    <div class="user-chip">
      <div class="user-avatar">BL</div>
      <div class="user-info">
        <div class="name">Admin User</div>
        <div class="role">Production & R&D</div>
      </div>
    </div>
  </div>
</aside>

<!-- MAIN -->
<main class="main">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-left">
      <h1 id="page-title">Dashboard</h1>
      <div class="breadcrumb" id="page-breadcrumb">Benton Lane â†’ Overview</div>
    </div>
    <div class="topbar-right">
      <div class="notif-btn">ðŸ””<div class="notif-dot"></div></div>
      <button class="btn btn-primary" onclick="showPage('submit', document.querySelector('[onclick*=\'submit\']'))">ï¼‹ New Idea</button>
    </div>
  </div>

  <!-- â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page active" id="page-dashboard">
    <div style="padding: 32px;">

      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-label">Active in Pipeline</div>
          <div class="stat-value">8</div>
          <div class="stat-sub"><span>+2</span> from last month</div>
        </div>
        <div class="stat-card accent">
          <div class="stat-label">Awaiting Feasibility</div>
          <div class="stat-value">3</div>
          <div class="stat-sub"><span class="warn">Action needed</span></div>
        </div>
        <div class="stat-card success">
          <div class="stat-label">Launched This Quarter</div>
          <div class="stat-value">2</div>
          <div class="stat-sub"><span>On track</span> with targets</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-label">Avg. Prototype Time</div>
          <div class="stat-value">24<span style="font-size:18px">d</span></div>
          <div class="stat-sub">Target: <span>â‰¤ 30 days</span></div>
        </div>
      </div>

      <div class="two-col" style="margin-bottom: 24px;">
        <div class="card">
          <div class="card-head">
            <div class="card-head-title">Recent Activity</div>
            <span style="font-size:11px;color:var(--muted);cursor:pointer">View all â†’</span>
          </div>
          <div class="card-body" id="dashboard-activity-feed">">
            <div class="activity-item">
              <div class="activity-dot green"></div>
              <div>
                <div class="activity-text"><strong>Wrought Iron Wall Panel</strong> moved to Prototype stage</div>
                <div class="activity-time">2 hours ago Â· Metal Fab Shop</div>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-dot"></div>
              <div>
                <div class="activity-text"><strong>Botanical Wrapping Paper Series</strong> submitted by Venture Builder</div>
                <div class="activity-time">Yesterday Â· Painted Paper</div>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-dot orange"></div>
              <div>
                <div class="activity-text"><strong>Carbon Steel Side Table</strong> feasibility review overdue</div>
                <div class="activity-time">3 days ago Â· Carbon Designs</div>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-dot green"></div>
              <div>
                <div class="activity-text"><strong>Linen Texture Wallpaper</strong> approved for production handoff</div>
                <div class="activity-time">4 days ago Â· Aspen & Arlo</div>
              </div>
            </div>
            <div class="activity-item">
              <div class="activity-dot"></div>
              <div>
                <div class="activity-text"><strong>Geometric Wall Sculpture</strong> brand brief uploaded to vault</div>
                <div class="activity-time">5 days ago Â· Anthem Classic</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-head">
            <div class="card-head-title">Shop Capacity â€” This Week</div>
            <span style="font-size:11px;color:var(--muted);cursor:pointer" onclick="showPage('capacity', null)">Details â†’</span>
          </div>
          <div class="card-body">
            <div class="capacity-item">
              <div class="capacity-label">
                <span>Metal Fab Shop</span>
                <span>72% utilized</span>
              </div>
              <div class="capacity-track"><div class="capacity-fill warn" style="width:72%"></div></div>
            </div>
            <div class="capacity-item">
              <div class="capacity-label">
                <span>Print Shop</span>
                <span>45% utilized</span>
              </div>
              <div class="capacity-track"><div class="capacity-fill ok" style="width:45%"></div></div>
            </div>
            <div style="margin-top:20px;">
              <div class="card-head-title" style="font-size:13px;margin-bottom:12px;">Pipeline by Stage</div>
              <div style="display:flex;gap:6px;align-items:flex-end;height:60px;">
                <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;">
                  <div style="width:100%;background:var(--brown);border-radius:3px 3px 0 0;" class="stagger-bar" data-h="40"></div>
                  <span style="font-size:9px;color:var(--muted)">Brief</span>
                </div>
                <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;">
                  <div style="width:100%;background:var(--brown-mid);border-radius:3px 3px 0 0;" class="stagger-bar" data-h="25"></div>
                  <span style="font-size:9px;color:var(--muted)">Feasib.</span>
                </div>
                <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;">
                  <div style="width:100%;background:var(--brown-light);border-radius:3px 3px 0 0;" class="stagger-bar" data-h="50"></div>
                  <span style="font-size:9px;color:var(--muted)">Proto.</span>
                </div>
                <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;">
                  <div style="width:100%;background:var(--charcoal);border-radius:3px 3px 0 0;" class="stagger-bar" data-h="30"></div>
                  <span style="font-size:9px;color:var(--muted)">Test</span>
                </div>
                <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;">
                  <div style="width:100%;background:var(--success);border-radius:3px 3px 0 0;" class="stagger-bar" data-h="15"></div>
                  <span style="font-size:9px;color:var(--muted)">Launch</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- â”€â”€ PIPELINE BOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-pipeline">
    <div style="padding: 32px;">
      <div class="team-strip">
        <div class="team-chip chip-all">All Products</div>
        <div class="team-chip chip-vb" onclick="this.classList.toggle('active')">Venture Builder</div>
        <div class="team-chip chip-prod" onclick="this.classList.toggle('active')">Metal Fab</div>
        <div class="team-chip chip-prod" onclick="this.classList.toggle('active')">Print Shop</div>
      </div>

      <div class="pipeline-board">
        <!-- Idea Brief -->
        <div class="pipeline-col">
          <div class="pipeline-col-header">
            <span class="pipeline-col-title">01 Â· Idea Brief</span>
            <span class="pipeline-col-count">3</span>
          </div>
          <div class="pipeline-col-body" id="pipeline-col-brief">
            <div class="pipeline-card" onclick="openModal('Botanical Wrapping Paper Series', 'Painted Paper', 'Print Shop', 'New', 'â€”', 'VB Team submitted a full brief. Awaiting Production intake.')">
              <div class="card-tag tag-print">Print</div>
              <div class="card-title">Botanical Wrapping Paper Series</div>
              <div class="card-brand">Painted Paper</div>
              <div class="card-footer">
                <span class="card-days">Submitted 2d ago</span>
                <div class="mini-avatar" style="background:var(--charcoal)">VB</div>
              </div>
            </div>
            <div class="pipeline-card" onclick="openModal('Heritage Linen Fabric Line', 'Maison & Twill', 'Print Shop', 'New', 'â€”', 'Concept brief received. Fabric specs and colorway direction attached.')">
              <div class="card-tag tag-print">Print</div>
              <div class="card-title">Heritage Linen Fabric Line</div>
              <div class="card-brand">Maison & Twill</div>
              <div class="card-footer">
                <span class="card-days">Submitted 4d ago</span>
                <div class="mini-avatar" style="background:var(--charcoal)">VB</div>
              </div>
            </div>
            <div class="pipeline-card" onclick="openModal('Forged Iron Candle Stand', 'Anthem Classic', 'Metal Fab', 'New', 'â€”', 'Early concept sketch submitted. Material direction: raw iron with wax finish.')">
              <div class="card-tag tag-metal">Metal</div>
              <div class="card-title">Forged Iron Candle Stand</div>
              <div class="card-brand">Anthem Classic</div>
              <div class="card-footer">
                <span class="card-days">Submitted 6d ago</span>
                <div class="mini-avatar" style="background:var(--charcoal)">VB</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Feasibility -->
        <div class="pipeline-col">
          <div class="pipeline-col-header">
            <span class="pipeline-col-title">02 Â· Feasibility</span>
            <span class="pipeline-col-count">2</span>
          </div>
          <div class="pipeline-col-body" id="pipeline-col-feasibility">
            <div class="pipeline-card" onclick="openModal('Carbon Steel Side Table', 'Carbon Designs', 'Metal Fab', 'Pending Review', '3 days overdue', 'Feasibility review assigned to Metal Fab ops lead. Material cost estimate in progress.')">
              <div class="card-tag tag-metal">Metal</div>
              <div class="card-title">Carbon Steel Side Table</div>
              <div class="card-brand">Carbon Designs</div>
              <div class="card-footer">
                <span class="card-days overdue">3d overdue</span>
                <div class="mini-avatar" style="background:var(--brown)">RD</div>
              </div>
            </div>
            <div class="pipeline-card" onclick="openModal('Geometric Peel & Stick Wallpaper', 'Lemon Park', 'Print Shop', 'In Review', '5 days', 'Print team reviewing substrate options. Two colorways under consideration.')">
              <div class="card-tag tag-print">Print</div>
              <div class="card-title">Geometric Peel & Stick Wallpaper</div>
              <div class="card-brand">Lemon Park</div>
              <div class="card-footer">
                <span class="card-days">In review Â· 5d</span>
                <div class="mini-avatar" style="background:var(--brown)">RD</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Prototype -->
        <div class="pipeline-col">
          <div class="pipeline-col-header">
            <span class="pipeline-col-title">03 Â· Prototype</span>
            <span class="pipeline-col-count">2</span>
          </div>
          <div class="pipeline-col-body" id="pipeline-col-prototype">
            <div class="pipeline-card" onclick="openModal('Wrought Iron Wall Panel', 'Anthem Classic', 'Metal Fab', 'In Progress', '18 days', 'First sample completed. Finishing and patina application in progress. On track.')">
              <div class="card-tag tag-metal">Metal</div>
              <div class="card-title">Wrought Iron Wall Panel</div>
              <div class="card-brand">Anthem Classic</div>
              <div class="card-footer">
                <span class="card-days">Day 18 of 30</span>
                <div class="mini-avatar" style="background:var(--brown)">RD</div>
              </div>
            </div>
            <div class="pipeline-card" onclick="openModal('Meadow Print Fabric Roll', 'Aspen & Arlo', 'Print Shop', 'In Progress', '11 days', 'Test run completed on 60\" wide linen. Color accuracy at 94%. Second pass scheduled.')">
              <div class="card-tag tag-print">Print</div>
              <div class="card-title">Meadow Print Fabric Roll</div>
              <div class="card-brand">Aspen & Arlo</div>
              <div class="card-footer">
                <span class="card-days">Day 11 of 30</span>
                <div class="mini-avatar" style="background:var(--brown)">RD</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Test & Refine -->
        <div class="pipeline-col">
          <div class="pipeline-col-header">
            <span class="pipeline-col-title">04 Â· Test & Refine</span>
            <span class="pipeline-col-count">1</span>
          </div>
          <div class="pipeline-col-body" id="pipeline-col-test">
            <div class="pipeline-card" onclick="openModal('Linen Texture Wallpaper', 'Aspen & Arlo', 'Print Shop', 'Joint Review', '26 days', 'Prototype approved by Print team. Venture Builder reviewing final colorways. Sign-off meeting scheduled for Friday.')">
              <div class="card-tag tag-both">Both Teams</div>
              <div class="card-title">Linen Texture Wallpaper</div>
              <div class="card-brand">Aspen & Arlo</div>
              <div class="card-footer">
                <span class="card-days">Day 26 of 30</span>
                <div style="display:flex;">
                  <div class="mini-avatar" style="background:var(--charcoal);margin-right:-6px">VB</div>
                  <div class="mini-avatar" style="background:var(--brown)">RD</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Launch -->
        <div class="pipeline-col">
          <div class="pipeline-col-header">
            <span class="pipeline-col-title">05 Â· Launch</span>
            <span class="pipeline-col-count">2</span>
          </div>
          <div class="pipeline-col-body" id="pipeline-col-launch">
            <div class="pipeline-card" onclick="openModal('Arc Steel Floor Lamp', 'Carbon Designs', 'Metal Fab', 'Launched', '28 days total', 'Successfully launched Q1. Production handoff complete. Now in active catalog.')">
              <div class="card-tag tag-metal">Metal</div>
              <div class="card-title">Arc Steel Floor Lamp</div>
              <div class="card-brand">Carbon Designs</div>
              <div class="card-footer">
                <span class="card-days" style="color:var(--success);font-weight:600">âœ“ Launched</span>
              </div>
            </div>
            <div class="pipeline-card" onclick="openModal('Holiday Gift Wrap Collection', 'Painted Paper', 'Print Shop', 'Launched', '22 days total', 'Q4 seasonal launch. Full production run completed. Strong initial sell-through.')">
              <div class="card-tag tag-print">Print</div>
              <div class="card-title">Holiday Gift Wrap Collection</div>
              <div class="card-brand">Painted Paper</div>
              <div class="card-footer">
                <span class="card-days" style="color:var(--success);font-weight:600">âœ“ Launched</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ SUBMIT IDEA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-submit">
    <div style="padding:32px;">
      <div class="submit-card">
        <div class="submit-card-head">
          <h2>Submit a New Concept</h2>
          <p>Complete the brief below. Production & R&D will review feasibility within 5 business days.</p>
        </div>
        <div class="submit-card-body">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Concept Name</label>
              <input class="form-input" id="si-name" type="text" placeholder="e.g. Hammered Copper Wall Art">
            </div>
            <div class="form-group">
              <label class="form-label">Brand / Company</label>
              <select class="form-select" id="si-brand">
                <option value="">Select brand...</option>
                <option>Anthem Classic</option>
                <option>Carbon Designs</option>
                <option>Painted Paper</option>
                <option>Aspen &amp; Arlo</option>
                <option>Lemon Park</option>
                <option>Maison &amp; Twill</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Production Facility</label>
              <select class="form-select" id="si-shop">
                <option value="">Select shop...</option>
                <option>Metal Fab Shop</option>
                <option>Print Shop</option>
                <option>Both / Unsure</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Target Launch Window</label>
              <select class="form-select" id="si-launch">
                <option value="">Select window...</option>
                <option>Q1 2026</option>
                <option>Q2 2026</option>
                <option>Q3 2026</option>
                <option>Q4 2026</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Concept Description</label>
            <textarea class="form-textarea" id="si-desc" placeholder="Describe the product concept, intended look and feel, and what makes it right for this brand..."></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Target Market &amp; Positioning</label>
            <textarea class="form-textarea" id="si-market" style="min-height:70px" placeholder="Who is this for? What problem does it solve or what feeling does it evoke?"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Estimated Retail Price Range</label>
              <input class="form-input" id="si-price" type="text" placeholder="e.g. $85 â€“ $150">
            </div>
            <div class="form-group">
              <label class="form-label">Priority Level</label>
              <select class="form-select" id="si-priority">
                <option>Standard</option>
                <option>High Priority</option>
                <option>Exploratory</option>
              </select>
            </div>
          </div>
          <div style="display:flex;gap:12px;margin-top:8px;">
            <button class="btn btn-primary" onclick="submitIdea()" style="flex:1;justify-content:center;">Submit to Production &amp; R&D â†’</button>
            <button class="btn btn-secondary" onclick="clearIdeaForm()">Clear Form</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ ROADMAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-roadmap">
    <div style="padding:32px;">
      <div class="card">
        <div class="card-head">
          <div class="card-head-title">Product Roadmap â€” All Active Concepts</div>
          <div style="display:flex;gap:8px;">
            <span class="status-pill pill-approved">â— Launched</span>
            <span class="status-pill pill-review">â— In Pipeline</span>
            <span class="status-pill pill-pending">â— Needs Action</span>
          </div>
        </div>
        <div class="card-body" style="padding:0;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Brand</th>
                <th>Shop</th>
                <th>Stage</th>
                <th>Status</th>
                <th>Days Active</th>
              </tr>
            </thead>
            <tbody>
              <tr onclick="openModal('Wrought Iron Wall Panel','Anthem Classic','Metal Fab','Prototype','18 days','First sample completed. Finishing in progress.')">
                <td><strong>Wrought Iron Wall Panel</strong></td>
                <td>Anthem Classic</td>
                <td>Metal Fab</td>
                <td>Prototype</td>
                <td><span class="status-pill pill-review">â— In Progress</span></td>
                <td>18d</td>
              </tr>
              <tr onclick="openModal('Linen Texture Wallpaper','Aspen & Arlo','Print Shop','Test & Refine','26 days','Joint team review in progress.')">
                <td><strong>Linen Texture Wallpaper</strong></td>
                <td>Aspen & Arlo</td>
                <td>Print Shop</td>
                <td>Test & Refine</td>
                <td><span class="status-pill pill-review">â— Joint Review</span></td>
                <td>26d</td>
              </tr>
              <tr onclick="openModal('Carbon Steel Side Table','Carbon Designs','Metal Fab','Feasibility','3 days overdue','Feasibility review overdue.')">
                <td><strong>Carbon Steel Side Table</strong></td>
                <td>Carbon Designs</td>
                <td>Metal Fab</td>
                <td>Feasibility</td>
                <td><span class="status-pill pill-pending">â— Overdue</span></td>
                <td>12d</td>
              </tr>
              <tr onclick="openModal('Meadow Print Fabric Roll','Aspen & Arlo','Print Shop','Prototype','11 days','Test run completed on linen.')">
                <td><strong>Meadow Print Fabric Roll</strong></td>
                <td>Aspen & Arlo</td>
                <td>Print Shop</td>
                <td>Prototype</td>
                <td><span class="status-pill pill-review">â— In Progress</span></td>
                <td>11d</td>
              </tr>
              <tr onclick="openModal('Botanical Wrapping Paper Series','Painted Paper','Print Shop','Idea Brief','2 days','Awaiting Production intake.')">
                <td><strong>Botanical Wrapping Paper Series</strong></td>
                <td>Painted Paper</td>
                <td>Print Shop</td>
                <td>Idea Brief</td>
                <td><span class="status-pill pill-hold">â— Awaiting Intake</span></td>
                <td>2d</td>
              </tr>
              <tr onclick="openModal('Arc Steel Floor Lamp','Carbon Designs','Metal Fab','Launched','28 days total','Live in catalog.')">
                <td><strong>Arc Steel Floor Lamp</strong></td>
                <td>Carbon Designs</td>
                <td>Metal Fab</td>
                <td>Launched</td>
                <td><span class="status-pill pill-approved">â— Live</span></td>
                <td>28d</td>
              </tr>
              <tr onclick="openModal('Holiday Gift Wrap Collection','Painted Paper','Print Shop','Launched','22 days total','Full production run complete.')">
                <td><strong>Holiday Gift Wrap Collection</strong></td>
                <td>Painted Paper</td>
                <td>Print Shop</td>
                <td>Launched</td>
                <td><span class="status-pill pill-approved">â— Live</span></td>
                <td>22d</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ FEASIBILITY REVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-feasibility">
    <div style="padding:32px;">
      <div class="card" style="margin-bottom:20px;">
        <div class="card-head">
          <div class="card-head-title">Pending Feasibility Reviews</div>
          <span id="feasibility-count-badge" style="font-size:12px;color:var(--warning);font-weight:600;">3 awaiting decision</span>
        </div>
        <div class="card-body" style="padding:0;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Concept</th>
                <th>Brand</th>
                <th>Submitted By</th>
                <th>Shop</th>
                <th>Days Waiting</th>
                <th>Decision</th>
              </tr>
            </thead>
            <tbody id="feasibility-tbody">
              <tr>
                <td><strong>Carbon Steel Side Table</strong></td>
                <td>Carbon Designs</td>
                <td>Venture Builder</td>
                <td>Metal Fab</td>
                <td style="color:var(--warning);font-weight:600">12d âš </td>
                <td>
                  <div style="display:flex;gap:6px;">
                    <button class="btn btn-primary" style="padding:4px 10px;font-size:11px;" onclick="approve(this)">Approve</button>
                    <button class="btn btn-secondary" style="padding:4px 10px;font-size:11px;" onclick="holdItem(this)">Hold</button>
                  </div>
                </td>
              </tr>
              <tr>
                <td><strong>Botanical Wrapping Paper Series</strong></td>
                <td>Painted Paper</td>
                <td>Venture Builder</td>
                <td>Print Shop</td>
                <td>2d</td>
                <td>
                  <div style="display:flex;gap:6px;">
                    <button class="btn btn-primary" style="padding:4px 10px;font-size:11px;" onclick="approve(this)">Approve</button>
                    <button class="btn btn-secondary" style="padding:4px 10px;font-size:11px;" onclick="holdItem(this)">Hold</button>
                  </div>
                </td>
              </tr>
              <tr>
                <td><strong>Heritage Linen Fabric Line</strong></td>
                <td>Maison & Twill</td>
                <td>Venture Builder</td>
                <td>Print Shop</td>
                <td>4d</td>
                <td>
                  <div style="display:flex;gap:6px;">
                    <button class="btn btn-primary" style="padding:4px 10px;font-size:11px;" onclick="approve(this)">Approve</button>
                    <button class="btn btn-secondary" style="padding:4px 10px;font-size:11px;" onclick="holdItem(this)">Hold</button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="card-head"><div class="card-head-title">Recently Decided</div></div>
        <div class="card-body" style="padding:0;">
          <table class="data-table">
            <thead><tr><th>Concept</th><th>Brand</th><th>Shop</th><th>Decision</th><th>Date</th></tr></thead>
            <tbody>
              <tr><td><strong>Geometric Peel & Stick Wallpaper</strong></td><td>Lemon Park</td><td>Print Shop</td><td><span class="status-pill pill-review">â— In Review</span></td><td>Jan 14</td></tr>
              <tr><td><strong>Wrought Iron Wall Panel</strong></td><td>Anthem Classic</td><td>Metal Fab</td><td><span class="status-pill pill-approved">â— Approved</span></td><td>Jan 10</td></tr>
              <tr><td><strong>Meadow Print Fabric Roll</strong></td><td>Aspen & Arlo</td><td>Print Shop</td><td><span class="status-pill pill-approved">â— Approved</span></td><td>Jan 8</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ PROTOTYPE TRACKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-prototypes">
    <div style="padding:32px;">
      <div class="three-col">
        <div class="card">
          <div style="background:var(--brown);padding:14px 18px;">
            <div style="font-size:11px;color:var(--rule);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;">Metal Fab</div>
            <div style="font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:600;color:#fff;">Wrought Iron Wall Panel</div>
          </div>
          <div class="card-body">
            <div style="margin-bottom:14px;">
              <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:6px;"><span style="color:var(--muted)">Progress</span><span style="font-weight:600;color:var(--brown)">Day 18 of 30</span></div>
              <div class="capacity-track"><div class="capacity-fill" style="width:60%"></div></div>
            </div>
            <div class="detail-row"><span class="label">Brand</span><span class="val">Anthem Classic</span></div>
            <div class="detail-row"><span class="label">Shop</span><span class="val">Metal Fab</span></div>
            <div class="detail-row"><span class="label">Status</span><span class="val" style="color:var(--success)">On Track</span></div>
            <div style="margin-top:12px;background:var(--warm-white);border-radius:6px;padding:10px;font-size:12px;color:var(--body);">Latest note: First sample completed. Applying patina finish â€” two color options being tested.</div>
          </div>
        </div>

        <div class="card">
          <div style="background:var(--brown-mid);padding:14px 18px;">
            <div style="font-size:11px;color:var(--rule);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;">Print Shop</div>
            <div style="font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:600;color:#fff;">Meadow Print Fabric Roll</div>
          </div>
          <div class="card-body">
            <div style="margin-bottom:14px;">
              <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:6px;"><span style="color:var(--muted)">Progress</span><span style="font-weight:600;color:var(--brown)">Day 11 of 30</span></div>
              <div class="capacity-track"><div class="capacity-fill ok" style="width:37%"></div></div>
            </div>
            <div class="detail-row"><span class="label">Brand</span><span class="val">Aspen & Arlo</span></div>
            <div class="detail-row"><span class="label">Shop</span><span class="val">Print Shop</span></div>
            <div class="detail-row"><span class="label">Status</span><span class="val" style="color:var(--success)">On Track</span></div>
            <div style="margin-top:12px;background:var(--warm-white);border-radius:6px;padding:10px;font-size:12px;color:var(--body);">Latest note: Color accuracy at 94% on linen substrate. Second pass scheduled for Thursday.</div>
          </div>
        </div>

        <div class="card">
          <div style="background:var(--charcoal);padding:14px 18px;">
            <div style="font-size:11px;color:var(--rule);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;">Print Shop</div>
            <div style="font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:600;color:#fff;">Linen Texture Wallpaper</div>
          </div>
          <div class="card-body">
            <div style="margin-bottom:14px;">
              <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:6px;"><span style="color:var(--muted)">Progress</span><span style="font-weight:600;color:var(--warning)">Day 26 of 30</span></div>
              <div class="capacity-track"><div class="capacity-fill warn" style="width:87%"></div></div>
            </div>
            <div class="detail-row"><span class="label">Brand</span><span class="val">Aspen & Arlo</span></div>
            <div class="detail-row"><span class="label">Shop</span><span class="val">Print Shop</span></div>
            <div class="detail-row"><span class="label">Status</span><span class="val" style="color:var(--warning)">In Joint Review</span></div>
            <div style="margin-top:12px;background:var(--warm-white);border-radius:6px;padding:10px;font-size:12px;color:var(--body);">Latest note: Prototype approved by Production. Venture Builder reviewing final colorway selection before sign-off.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ SHOP CAPACITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-capacity">
    <div style="padding:32px;">
      <div class="two-col">
        <div class="card">
          <div class="card-head" style="background:var(--brown);border-radius:10px 10px 0 0;">
            <div class="card-head-title" style="color:#fff;">Metal Fab Shop</div>
            <span style="font-size:12px;color:var(--rule);">Anthem Classic Â· Carbon Designs</span>
          </div>
          <div class="card-body">
            <div style="font-family:'Cormorant Garamond',serif;font-size:42px;font-weight:700;color:var(--warning);margin-bottom:4px;">72%</div>
            <div style="font-size:12px;color:var(--muted);margin-bottom:20px;">Current weekly utilization</div>
            <div class="capacity-item">
              <div class="capacity-label"><span>Wrought Iron Wall Panel</span><span>Active</span></div>
              <div class="capacity-track"><div class="capacity-fill" style="width:40%"></div></div>
            </div>
            <div class="capacity-item">
              <div class="capacity-label"><span>Carbon Steel Side Table</span><span>Pending</span></div>
              <div class="capacity-track"><div class="capacity-fill warn" style="width:25%"></div></div>
            </div>
            <div class="capacity-item">
              <div class="capacity-label"><span>Forged Iron Candle Stand</span><span>Queued</span></div>
              <div class="capacity-track"><div class="capacity-fill ok" style="width:15%"></div></div>
            </div>
            <div style="padding:12px;background:rgba(181,118,42,0.08);border-radius:6px;border:1px solid rgba(181,118,42,0.2);margin-top:8px;">
              <div style="font-size:12px;color:var(--warning);font-weight:600;">âš  Approaching capacity</div>
              <div style="font-size:11px;color:var(--muted);margin-top:2px;">Consider staggering new intake â€” 3 projects currently active or queued.</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-head" style="background:var(--brown-mid);border-radius:10px 10px 0 0;">
            <div class="card-head-title" style="color:#fff;">Print Shop</div>
            <span style="font-size:12px;color:var(--rule);">Painted Paper Â· Aspen & Arlo Â· Lemon Park Â· Maison & Twill</span>
          </div>
          <div class="card-body">
            <div style="font-family:'Cormorant Garamond',serif;font-size:42px;font-weight:700;color:var(--success);margin-bottom:4px;">45%</div>
            <div style="font-size:12px;color:var(--muted);margin-bottom:20px;">Current weekly utilization</div>
            <div class="capacity-item">
              <div class="capacity-label"><span>Linen Texture Wallpaper</span><span>Test & Refine</span></div>
              <div class="capacity-track"><div class="capacity-fill" style="width:20%"></div></div>
            </div>
            <div class="capacity-item">
              <div class="capacity-label"><span>Meadow Print Fabric Roll</span><span>Prototype</span></div>
              <div class="capacity-track"><div class="capacity-fill" style="width:18%"></div></div>
            </div>
            <div class="capacity-item">
              <div class="capacity-label"><span>Geometric Wallpaper</span><span>Feasibility</span></div>
              <div class="capacity-track"><div class="capacity-fill ok" style="width:10%"></div></div>
            </div>
            <div style="padding:12px;background:rgba(74,124,89,0.08);border-radius:6px;border:1px solid rgba(74,124,89,0.2);margin-top:8px;">
              <div style="font-size:12px;color:var(--success);font-weight:600;">âœ“ Capacity available</div>
              <div style="font-size:11px;color:var(--muted);margin-top:2px;">Print Shop can absorb 2â€“3 additional intake projects this month.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ PROJECTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-projects">
    <div style="padding:32px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;">
        <div>
          <div style="font-size:13px;color:var(--muted);">All teams can view and edit. Changes are visible instantly across both departments.</div>
        </div>
        <button class="btn btn-primary" onclick="openNewProjectModal()">ï¼‹ New Project</button>
      </div>
      <div class="project-list" id="project-list"></div>
    </div>
  </div>

  <!-- â”€â”€ DOCUMENT VAULT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-vault">
    <div style="padding:32px;">
      <div class="doc-grid">
        <div class="doc-card"><div class="doc-icon">ðŸ“„</div><div class="doc-name">Wrought Iron Wall Panel â€” Brand Brief</div><div class="doc-meta">Uploaded Jan 8 Â· Venture Builder</div><div class="doc-tag">Anthem Classic</div></div>
        <div class="doc-card"><div class="doc-icon">ðŸ“</div><div class="doc-name">Carbon Steel Side Table â€” Spec Sheet</div><div class="doc-meta">Uploaded Jan 12 Â· Production R&D</div><div class="doc-tag">Carbon Designs</div></div>
        <div class="doc-card"><div class="doc-icon">ðŸŽ¨</div><div class="doc-name">Linen Wallpaper â€” Colorway Samples</div><div class="doc-meta">Uploaded Jan 15 Â· Venture Builder</div><div class="doc-tag">Aspen & Arlo</div></div>
        <div class="doc-card"><div class="doc-icon">ðŸ“‹</div><div class="doc-name">Meadow Fabric â€” Print Test Results</div><div class="doc-meta">Uploaded Jan 13 Â· Production R&D</div><div class="doc-tag">Aspen & Arlo</div></div>
        <div class="doc-card"><div class="doc-icon">ðŸ“„</div><div class="doc-name">Botanical Wrapping Paper â€” Concept Brief</div><div class="doc-meta">Uploaded Jan 17 Â· Venture Builder</div><div class="doc-tag">Painted Paper</div></div>
        <div class="doc-card"><div class="doc-icon">âœ…</div><div class="doc-name">Arc Steel Floor Lamp â€” Launch Checklist</div><div class="doc-meta">Uploaded Jan 5 Â· Production R&D</div><div class="doc-tag">Carbon Designs</div></div>
        <div class="doc-card"><div class="doc-icon">ðŸ“Š</div><div class="doc-name">Q1 Pipeline Status Report</div><div class="doc-meta">Uploaded Jan 16 Â· Admin</div><div class="doc-tag">All Brands</div></div>
        <div class="doc-card"><div class="doc-icon">ðŸ“</div><div class="doc-name">Metal Fab â€” Materials Cost Estimate</div><div class="doc-meta">Uploaded Jan 11 Â· Production R&D</div><div class="doc-tag">Metal Fab Shop</div></div>
        <div class="doc-card"><div class="doc-icon">ðŸ–¨</div><div class="doc-name">Print Shop â€” Substrate Reference Guide</div><div class="doc-meta">Uploaded Dec 20 Â· Production R&D</div><div class="doc-tag">Print Shop</div></div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ KPI DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-kpis">
    <div style="padding:32px;">
      <div class="two-col" style="margin-bottom:20px;">
        <div class="card">
          <div class="card-head"><div class="card-head-title">Key Performance Indicators</div><span style="font-size:11px;color:var(--muted)">Month-to-date</span></div>
          <div class="card-body">
            <div class="kpi-grid">
              <div class="kpi-item">
                <div class="kpi-name">Prototype Turnaround</div>
                <div class="kpi-val">24<span style="font-size:16px">d</span></div>
                <div class="kpi-target">Target: <span>â‰¤ 30 days âœ“</span></div>
              </div>
              <div class="kpi-item">
                <div class="kpi-name">Pipeline Volume</div>
                <div class="kpi-val">8</div>
                <div class="kpi-target">Target: <span>3â€“5 active</span> (exceeded)</div>
              </div>
              <div class="kpi-item">
                <div class="kpi-name">Cross-Shop Projects</div>
                <div class="kpi-val">1</div>
                <div class="kpi-target">Target: 25% â€” <span style="color:var(--warning)">building</span></div>
              </div>
              <div class="kpi-item">
                <div class="kpi-name">VB Cycle Time</div>
                <div class="kpi-val">6<span style="font-size:16px">d</span></div>
                <div class="kpi-target">Target: <span>â‰¤ 14 days âœ“</span></div>
              </div>
              <div class="kpi-item">
                <div class="kpi-name">Launched This Qtr</div>
                <div class="kpi-val">2</div>
                <div class="kpi-target">Target: <span>on track</span></div>
              </div>
              <div class="kpi-item">
                <div class="kpi-name">Launch Success Rate</div>
                <div class="kpi-val">100<span style="font-size:16px">%</span></div>
                <div class="kpi-target">Target: <span>â‰¥ 60% âœ“</span></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-head"><div class="card-head-title">Pipeline Health Summary</div></div>
          <div class="card-body">
            <div class="activity-item">
              <div class="activity-dot green"></div>
              <div><div class="activity-text"><strong>2 products launched</strong> this quarter â€” Arc Steel Floor Lamp and Holiday Gift Wrap Collection both live.</div></div>
            </div>
            <div class="activity-item">
              <div class="activity-dot orange"></div>
              <div><div class="activity-text"><strong>1 overdue feasibility review</strong> â€” Carbon Steel Side Table at 12 days, action required from Metal Fab team.</div></div>
            </div>
            <div class="activity-item">
              <div class="activity-dot"></div>
              <div><div class="activity-text"><strong>Metal Fab at 72% capacity</strong> â€” approaching limit. Consider staggering new intakes for this shop.</div></div>
            </div>
            <div class="activity-item">
              <div class="activity-dot green"></div>
              <div><div class="activity-text"><strong>Print Shop has runway</strong> â€” 45% utilized, able to absorb 2â€“3 additional projects this month.</div></div>
            </div>
            <div class="activity-item">
              <div class="activity-dot green"></div>
              <div><div class="activity-text"><strong>Linen Texture Wallpaper</strong> entering final sign-off â€” expected to move to Launch stage by end of week.</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- â”€â”€ OPS PERFORMANCE METRICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-opsmetrics">
    <div style="padding:32px;">

      <!-- Top control bar -->
      <div class="ops-control-bar">
        <div class="ops-view-tabs" id="ops-view-tabs">
          <button class="ops-view-tab active" onclick="setOpsView('hourly',this)">Hourly</button>
          <button class="ops-view-tab" onclick="setOpsView('daily',this)">Daily</button>
          <button class="ops-view-tab" onclick="setOpsView('weekly',this)">Weekly</button>
          <button class="ops-view-tab" onclick="setOpsView('monthly',this)">Monthly</button>
          <button class="ops-view-tab" onclick="setOpsView('quarterly',this)">Quarterly</button>
          <button class="ops-view-tab" onclick="setOpsView('yoy',this)">Year-over-Year</button>
        </div>
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="ops-shop-filter">
            <button class="ops-filter-btn active" onclick="setOpsShop('both',this)">Both Shops</button>
            <button class="ops-filter-btn" onclick="setOpsShop('metal',this)">âš™ Metal Fab</button>
            <button class="ops-filter-btn" onclick="setOpsShop('print',this)">ðŸ–¨ Print Shop</button>
          </div>
          <div class="ops-data-badge">
            <span class="ops-data-dot"></span>
            Structure Ready â€” ERP/MES Connect Pending
          </div>
        </div>
      </div>

      <!-- KPI Summary Strip -->
      <div class="ops-kpi-strip" id="ops-kpi-strip"></div>

      <!-- Main chart area -->
      <div class="ops-chart-grid">
        <!-- Primary trend chart (line) -->
        <div class="ops-chart-card wide">
          <div class="ops-chart-header">
            <div>
              <div class="ops-chart-title" id="ops-trend-title">Units Produced â€” Trend</div>
              <div class="ops-chart-sub" id="ops-trend-sub">Loading...</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;">
              <select class="ops-metric-select" onchange="setOpsMetric(this.value)" id="ops-metric-select">
                <option value="units">Units Produced</option>
                <option value="revenue">Revenue</option>
                <option value="defects">Defects</option>
                <option value="laborHrs">Labor Hrs / Unit</option>
                <option value="onTime">On-Time Rate %</option>
                <option value="leadTime">Avg Lead Time (days)</option>
              </select>
            </div>
          </div>
          <div class="ops-line-chart-wrap">
            <canvas id="ops-line-canvas" width="900" height="220"></canvas>
          </div>
        </div>

        <!-- Bar comparison chart -->
        <div class="ops-chart-card">
          <div class="ops-chart-header">
            <div>
              <div class="ops-chart-title">Output by Product</div>
              <div class="ops-chart-sub" id="ops-bar-sub">Current period</div>
            </div>
          </div>
          <div class="ops-bar-chart-wrap">
            <canvas id="ops-bar-canvas" width="420" height="220"></canvas>
          </div>
        </div>

        <!-- Target vs Actual -->
        <div class="ops-chart-card">
          <div class="ops-chart-header">
            <div>
              <div class="ops-chart-title">Target vs. Actual</div>
              <div class="ops-chart-sub">Current period by product</div>
            </div>
          </div>
          <div id="ops-target-actual"></div>
        </div>
      </div>

      <!-- Metrics deep-dive grid -->
      <div class="ops-metrics-deep" id="ops-metrics-deep"></div>

      <!-- Historical data table -->
      <div class="ops-history-section">
        <div class="ops-history-header">
          <div class="ops-chart-title">Historical Data Log</div>
          <div style="display:flex;gap:8px;">
            <select class="ops-metric-select" onchange="setHistoryProduct(this.value)" id="history-product-select">
              <option value="all">All Products</option>
              <option value="wall-art">Metal Wall Art</option>
              <option value="furniture">Metal Furniture</option>
              <option value="wallpaper">Wallpaper</option>
              <option value="wrapping">Wrapping Paper</option>
              <option value="samples">Samples</option>
              <option value="fabric">Fabric</option>
            </select>
            <button class="ops-export-btn" onclick="showToast('Export to CSV â€” available when connected to ERP/MES.')">â†“ Export CSV</button>
          </div>
        </div>
        <div style="overflow-x:auto;">
          <table class="ops-history-table" id="ops-history-table">
            <thead>
              <tr>
                <th>Period</th>
                <th>Product</th>
                <th>Shop</th>
                <th>Units</th>
                <th>Target</th>
                <th>vs Target</th>
                <th>Revenue</th>
                <th>Defects</th>
                <th>On-Time %</th>
                <th>Avg Lead Time</th>
                <th>Labor Hrs/Unit</th>
              </tr>
            </thead>
            <tbody id="ops-history-tbody"></tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

</main>


<!-- TOAST -->
<div id="toast" style="
  display:none;
  position:fixed;
  bottom:28px;
  right:28px;
  background:var(--brown);
  color:#fff;
  padding:12px 20px;
  border-radius:8px;
  font-size:13px;
  font-weight:500;
  z-index:9999;
  box-shadow:0 4px 16px rgba(51,43,30,0.25);
  animation: fadeIn 0.2s ease;
"></div>

<!-- MODAL -->
<div class="modal-overlay" id="modal" onclick="closeModalOutside(event)">
  <div class="modal">
    <div class="modal-head">
      <div>
        <h3 id="modal-title"></h3>
        <div style="font-size:12px;color:var(--muted);margin-top:3px;" id="modal-brand"></div>
      </div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="detail-row"><span class="label">Production Facility</span><span class="val" id="modal-shop"></span></div>
      <div class="detail-row"><span class="label">Stage</span><span class="val" id="modal-stage"></span></div>
      <div class="detail-row"><span class="label">Time Active</span><span class="val" id="modal-time"></span></div>
      <div class="comment-box">
        <div class="comment-box-label">Latest Update</div>
        <div class="comment-text" id="modal-note"></div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary" onclick="closeModal();showToast('Update saved successfully.')">Save Note</button>
        <button class="btn btn-secondary" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>
</div>


<!-- NEW PROJECT MODAL -->
<div class="modal-overlay" id="new-project-modal" onclick="closeNewProjectModalOutside(event)">
  <div class="modal" style="width:480px;">
    <div class="modal-head">
      <div>
        <h3>New Project</h3>
        <div style="font-size:12px;color:var(--muted);margin-top:3px;">Create a shared project workspace for both teams</div>
      </div>
      <button class="modal-close" onclick="closeNewProjectModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="np-form">
        <div class="np-row">
          <div class="form-group" style="margin-bottom:0;">
            <label class="form-label">Project Name</label>
            <input class="form-input" id="np-name" type="text" placeholder="e.g. Copper Wall Sconce">
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label class="form-label">Brand</label>
            <select class="form-select" id="np-brand">
              <option value="">Select brand...</option>
              <option>Anthem Classic</option>
              <option>Carbon Designs</option>
              <option>Painted Paper</option>
              <option>Aspen & Arlo</option>
              <option>Lemon Park</option>
              <option>Maison & Twill</option>
            </select>
          </div>
        </div>
        <div class="np-row">
          <div class="form-group" style="margin-bottom:0;">
            <label class="form-label">Production Shop</label>
            <select class="form-select" id="np-shop">
              <option value="">Select shop...</option>
              <option>Metal Fab Shop</option>
              <option>Print Shop</option>
              <option>Both Shops</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label class="form-label">Pipeline Stage</label>
            <select class="form-select" id="np-stage">
              <option>Idea Brief</option>
              <option>Feasibility</option>
              <option>Prototype</option>
              <option>Test & Refine</option>
              <option>Launch</option>
            </select>
          </div>
        </div>
        <div class="modal-actions" style="margin-top:8px;">
          <button class="btn btn-primary" onclick="createProject()" style="flex:1;justify-content:center;">Create Project â†’</button>
          <button class="btn btn-secondary" onclick="closeNewProjectModal()">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const pages = {
  dashboard:   { title: 'Dashboard',            crumb: 'Benton Lane â†’ Overview' },
  pipeline:    { title: 'Pipeline Board',        crumb: 'Benton Lane â†’ Pipeline' },
  submit:      { title: 'Submit a New Idea',     crumb: 'Benton Lane â†’ Venture Builder â†’ Submit' },
  roadmap:     { title: 'Product Roadmap',       crumb: 'Benton Lane â†’ Venture Builder â†’ Roadmap' },
  feasibility: { title: 'Feasibility Review',    crumb: 'Benton Lane â†’ Production & R&D â†’ Feasibility' },
  prototypes:  { title: 'Prototype Tracker',     crumb: 'Benton Lane â†’ Production & R&D â†’ Prototypes' },
  capacity:    { title: 'Shop Capacity',         crumb: 'Benton Lane â†’ Production & R&D â†’ Capacity' },
  projects:    { title: 'Projects',               crumb: 'Benton Lane â†’ Shared â†’ Projects' },
  vault:       { title: 'Document Vault',        crumb: 'Benton Lane â†’ Shared â†’ Vault' },
  opsmetrics:  { title: 'Ops Performance Metrics',  crumb: 'Benton Lane â†’ Production & R&D â†’ Ops Performance' },
};

function showPage(id, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  if (el) el.classList.add('active');
  document.getElementById('page-title').textContent = pages[id].title;
  document.getElementById('page-breadcrumb').textContent = pages[id].crumb;
}

function openModal(title, brand, shop, stage, time, note) {
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-brand').textContent = brand;
  document.getElementById('modal-shop').textContent = shop;
  document.getElementById('modal-stage').textContent = stage;
  document.getElementById('modal-time').textContent = time;
  document.getElementById('modal-note').textContent = note;
  document.getElementById('modal').classList.add('open');
}

function closeModal() { document.getElementById('modal').classList.remove('open'); }
function closeModalOutside(e) { if (e.target.id === 'modal') closeModal(); }

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.style.display = 'block';
  setTimeout(() => t.style.display = 'none', 3000);
}

// Submitted ideas store (persists for session)
let submittedIdeas = [];

function submitIdea() {
  const name     = document.getElementById('si-name').value.trim();
  const brand    = document.getElementById('si-brand').value;
  const shop     = document.getElementById('si-shop').value;
  const launch   = document.getElementById('si-launch').value;
  const desc     = document.getElementById('si-desc').value.trim();
  const market   = document.getElementById('si-market').value.trim();
  const price    = document.getElementById('si-price').value.trim();
  const priority = document.getElementById('si-priority').value;

  // Validation
  if (!name)  { showToast('âš  Please enter a concept name.'); document.getElementById('si-name').focus(); return; }
  if (!brand) { showToast('âš  Please select a brand.'); return; }
  if (!shop)  { showToast('âš  Please select a production facility.'); return; }

  const idea = {
    id: Date.now(),
    name, brand, shop, launch, desc, market, price, priority,
    submittedAt: new Date(),
    daysWaiting: 0,
    stage: 'Idea Brief',
  };

  submittedIdeas.push(idea);

  // â”€â”€ 1. Add to Pipeline Board (Idea Brief column) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const shopTag = shop.includes('Metal') ? 'tag-metal' : shop.includes('Print') ? 'tag-print' : 'tag-both';
  const shopLabel = shop.includes('Metal') ? 'Metal' : shop.includes('Print') ? 'Print' : 'Both';
  const priorityBadge = priority === 'High Priority'
    ? '<span style="font-size:9px;font-weight:700;color:var(--warning);background:rgba(181,118,42,0.1);padding:1px 6px;border-radius:4px;margin-left:4px;">HIGH</span>'
    : priority === 'Exploratory'
    ? '<span style="font-size:9px;font-weight:700;color:var(--muted);background:var(--cream);padding:1px 6px;border-radius:4px;margin-left:4px;">EXPLORE</span>'
    : '';

  const pipelineCard = `<div class="pipeline-card" onclick="openModal('${esc(name)}','${esc(brand)}','${esc(shop)}','Idea Brief','Just submitted','${esc(desc || 'No description provided.')}')">
    <div class="card-tag ${shopTag}">${shopLabel}${priorityBadge}</div>
    <div class="card-title">${esc(name)}</div>
    <div class="card-brand">${esc(brand)}</div>
    <div class="card-footer">
      <span class="card-days">Just submitted</span>
      <div class="mini-avatar" style="background:var(--charcoal)">VB</div>
    </div>
  </div>`;
  const briefCol = document.getElementById('pipeline-col-brief');
  if (briefCol) briefCol.insertAdjacentHTML('afterbegin', pipelineCard);

  // â”€â”€ 2. Add to Feasibility Review table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const feasRow = `<tr id="feas-row-${idea.id}">
    <td><strong>${esc(name)}</strong></td>
    <td>${esc(brand)}</td>
    <td>Venture Builder</td>
    <td>${esc(shop)}</td>
    <td>Just now</td>
    <td>
      <div style="display:flex;gap:6px;">
        <button class="btn btn-primary" style="padding:4px 10px;font-size:11px;" onclick="approve(this)">Approve</button>
        <button class="btn btn-secondary" style="padding:4px 10px;font-size:11px;" onclick="holdItem(this)">Hold</button>
      </div>
    </td>
  </tr>`;
  const feasTbody = document.getElementById('feasibility-tbody');
  if (feasTbody) feasTbody.insertAdjacentHTML('afterbegin', feasRow);

  // â”€â”€ 3. Update feasibility count badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const feasBadge = document.getElementById('feasibility-count-badge');
  if (feasBadge) {
    const currentCount = parseInt(feasBadge.textContent) || 3;
    feasBadge.textContent = (currentCount + 1) + ' awaiting decision';
  }

  // â”€â”€ 4. Update pipeline nav badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const pipelineBadge = document.getElementById('pipeline-nav-badge');
  if (pipelineBadge) {
    const current = parseInt(pipelineBadge.textContent) || 8;
    pipelineBadge.textContent = current + 1;
  }

  // â”€â”€ 5. Add to Dashboard activity feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const activityFeed = document.getElementById('dashboard-activity-feed');
  if (activityFeed) {
    const actItem = `<div class="activity-item">
      <div class="activity-dot orange"></div>
      <div>
        <div class="activity-text"><strong>${esc(name)}</strong> submitted by Venture Builder â€” awaiting Production & R&D intake.</div>
        <div class="activity-time">Just now Â· ${esc(brand)}</div>
      </div>
    </div>`;
    activityFeed.insertAdjacentHTML('afterbegin', actItem);
  }

  // â”€â”€ 6. Create a Project entry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const shopShort = shop.includes('Metal') ? 'Metal Fab Shop' : shop.includes('Print') ? 'Print Shop' : 'Both';
  const newProj = {
    id: idea.id,
    name,
    brand,
    shop: shopShort,
    stage: 'Idea Brief',
    color: dotColors[projects.length % dotColors.length],
    notes: [desc, market ? 'Target market: ' + market : ''].filter(Boolean).join('\n\n'),
    suppliers: [],
    materials: [],
    labor: [],
    overhead: 10,
    targetMargin: 60,
    priceCompare: [],
  };
  projects.push(newProj);
  renderProjects();

  // â”€â”€ 7. Clear form and navigate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  clearIdeaForm();
  showToast('âœ“ "' + name + '" submitted â€” visible in Pipeline, Feasibility Review, and Projects.');
  setTimeout(() => showPage('pipeline', document.querySelector('[onclick*=\'pipeline\']')), 800);
}

function clearIdeaForm() {
  ['si-name','si-price'].forEach(id => { const el = document.getElementById(id); if(el) el.value = ''; });
  ['si-brand','si-shop','si-launch'].forEach(id => { const el = document.getElementById(id); if(el) el.selectedIndex = 0; });
  ['si-desc','si-market'].forEach(id => { const el = document.getElementById(id); if(el) el.value = ''; });
  const pri = document.getElementById('si-priority'); if(pri) pri.selectedIndex = 0;
}

function esc(str) {
  return String(str || '').replace(/'/g, "\'").replace(/"/g, '&quot;');
}

function approve(btn) {
  const row = btn.closest('tr');
  row.querySelector('td:last-child').innerHTML = '<span class="status-pill pill-approved">âœ“ Approved</span>';
  showToast('âœ“ Concept approved â€” moved to Prototype stage.');
}

function holdItem(btn) {
  const row = btn.closest('tr');
  row.querySelector('td:last-child').innerHTML = '<span class="status-pill pill-hold">On Hold</span>';
  showToast('Concept placed on hold.');
}

// â”€â”€ PROJECTS ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const dotColors = ['#332b1e','#4a3d2b','#3d3d3d','#4a7c59','#6b5a42','#b5762a'];

let projects = [
  {
    id: 1,
    name: 'Wrought Iron Wall Panel',
    brand: 'Anthem Classic',
    shop: 'Metal Fab Shop',
    stage: 'Prototype',
    color: dotColors[0],
    notes: 'First sample complete. Two patina finishes being tested â€” dark wax and raw iron. Venture Builder prefers the raw look. Aiming for 24" x 36" as the hero size.',
    suppliers: [
      { name: 'Midwest Steel Supply', contact: 'Jake Morrison', phone: '(312) 555-0182', leadTime: '7â€“10 days', status: 'Active' },
      { name: 'Atlas Finishing Co.', contact: 'Maria Chen', phone: '(773) 555-0341', leadTime: '3â€“5 days', status: 'Active' },
    ],
    materials: [
      { item: 'Wrought Iron Sheet (16ga)', supplier: 'Midwest Steel Supply', qty: '10', unitCost: 48, totalCost: 480 },
      { item: 'Wax Finishing Compound', supplier: 'Atlas Finishing Co.', qty: '2', unitCost: 32, totalCost: 64 },
      { item: 'Wall Mount Hardware Kit', supplier: 'In-house', qty: '10', unitCost: 8, totalCost: 80 },
    ],
    labor: [
      { task: 'Cutting & Forming', hours: 3.5, rate: 55, total: 192.50 },
      { task: 'Finishing & Patina', hours: 1.5, rate: 55, total: 82.50 },
      { task: 'QC & Packaging', hours: 0.5, rate: 45, total: 22.50 },
    ],
    overhead: 12,
    targetMargin: 60,
    priceCompare: [
      { supplier: 'Midwest Steel Supply', product: 480, packaging: 35, shipping: 62, notes: 'Bulk discount available at 50+ units' },
      { supplier: 'Atlas Finishing Co.',  product: 510, packaging: 28, shipping: 55, notes: 'Faster lead time, premium finish' },
    ],
  },
  {
    id: 2,
    name: 'Linen Texture Wallpaper',
    brand: 'Aspen & Arlo',
    shop: 'Print Shop',
    stage: 'Test & Refine',
    color: dotColors[2],
    notes: 'Prototype approved by Production. Joint review with Venture Builder on final colorways â€” three options shortlisted: Sage, Warm Ivory, and Slate. Sign-off call scheduled Friday.',
    suppliers: [
      { name: 'Cascade Paper Group', contact: 'Tom Reilly', phone: '(503) 555-0217', leadTime: '5â€“7 days', status: 'Active' },
      { name: 'ColorBlend Inks', contact: 'Sandra Wu', phone: '(206) 555-0088', leadTime: '2â€“3 days', status: 'Preferred' },
    ],
    materials: [
      { item: 'Type II Vinyl Wallpaper Base', supplier: 'Cascade Paper Group', qty: '500', unitCost: 0.85, totalCost: 425 },
      { item: 'Linen Texture Ink Set (4 colors)', supplier: 'ColorBlend Inks', qty: '1', unitCost: 210, totalCost: 210 },
      { item: 'Adhesive Backing', supplier: 'Cascade Paper Group', qty: '500', unitCost: 0.20, totalCost: 100 },
    ],
    labor: [
      { task: 'Print Setup & Calibration', hours: 2.0, rate: 45, total: 90 },
      { task: 'Production Run', hours: 3.0, rate: 40, total: 120 },
      { task: 'Cutting & Roll Packaging', hours: 1.0, rate: 38, total: 38 },
    ],
    overhead: 10,
    targetMargin: 55,
    priceCompare: [
      { supplier: 'Cascade Paper Group', product: 525, packaging: 42, shipping: 78, notes: 'Volume pricing on 500+ rolls' },
      { supplier: 'ColorBlend Inks',     product: 498, packaging: 50, shipping: 88, notes: 'Better ink quality, higher ship cost' },
    ],
  },
  {
    id: 3,
    name: 'Botanical Wrapping Paper Series',
    brand: 'Painted Paper',
    shop: 'Print Shop',
    stage: 'Idea Brief',
    color: dotColors[4],
    notes: 'Early concept stage. VB team envisions 3-design series â€” ferns, wildflowers, and citrus botanicals. Premium matte finish preferred. No supplier contacts assigned yet.',
    suppliers: [],
    materials: [],
    labor: [],
    overhead: 10,
    targetMargin: 65,
    priceCompare: [],
  },
];

let openProjectId = null;

function calcMaterialTotal(proj) {
  return proj.materials.reduce((s, r) => s + (parseFloat(r.totalCost) || 0), 0);
}
function calcLaborTotal(proj) {
  return proj.labor.reduce((s, r) => s + (parseFloat(r.total) || 0), 0);
}
function calcCOGS(proj) {
  const mat = calcMaterialTotal(proj);
  const lab = calcLaborTotal(proj);
  const oh  = (mat + lab) * ((parseFloat(proj.overhead) || 0) / 100);
  return mat + lab + oh;
}
function calcSuggestedPrice(proj) {
  const cogs = calcCOGS(proj);
  const margin = parseFloat(proj.targetMargin) || 60;
  return cogs / (1 - margin / 100);
}
function fmt(n) { return '$' + n.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ','); }

function renderProjects() {
  const container = document.getElementById('project-list');
  if (!container) return;
  container.innerHTML = '';
  projects.forEach(proj => container.appendChild(buildProjectCard(proj)));
}

function buildProjectCard(proj) {
  const cogs   = calcCOGS(proj);
  const price  = calcSuggestedPrice(proj);
  const matTot = calcMaterialTotal(proj);
  const labTot = calcLaborTotal(proj);
  const card = document.createElement('div');
  card.className = 'project-card';
  card.id = 'proj-card-' + proj.id;
  const isOpen = openProjectId === proj.id;
  card.innerHTML = `
    <div class="project-card-header ${isOpen?'open':''}" onclick="toggleProject(${proj.id})">
      <div class="project-card-header-left">
        <div class="project-color-dot" style="background:${proj.color}"></div>
        <div>
          <div class="project-name">${proj.name}</div>
          <div class="project-meta">${proj.brand} Â· ${proj.shop} Â· <span class="status-pill pill-review" style="font-size:10px;padding:1px 7px;">${proj.stage}</span></div>
        </div>
      </div>
      <div class="project-header-right">
        <div style="text-align:right;">
          <div class="project-total-label">Est. COGS</div>
          <div class="project-total">${cogs>0?fmt(cogs):'â€”'}</div>
        </div>
        <div style="text-align:right;">
          <div class="project-total-label">Suggested Retail</div>
          <div class="project-total" style="color:var(--success)">${price>0?fmt(price):'â€”'}</div>
        </div>
        <div class="project-chevron ${isOpen?'open':''}">â–¼</div>
      </div>
    </div>
    <div class="project-body ${isOpen?'open':''}">
      <div class="cost-summary">
        <div class="cost-summary-item"><div class="cost-summary-label">Materials</div><div class="cost-summary-val">${matTot>0?fmt(matTot):'â€”'}</div></div>
        <div class="cost-summary-item"><div class="cost-summary-label">Labor</div><div class="cost-summary-val">${labTot>0?fmt(labTot):'â€”'}</div></div>
        <div class="cost-summary-item"><div class="cost-summary-label">Total COGS</div><div class="cost-summary-val warn">${cogs>0?fmt(cogs):'â€”'}</div></div>
        <div class="cost-summary-item"><div class="cost-summary-label">Suggested Retail</div><div class="cost-summary-val highlight">${price>0?fmt(price):'â€”'}</div></div>
      </div>
      <div class="proj-tabs">
        <div class="proj-tab active" onclick="switchProjTab(${proj.id},'suppliers',this)">Suppliers</div>
        <div class="proj-tab" onclick="switchProjTab(${proj.id},'materials',this)">Materials & Costs</div>
        <div class="proj-tab" onclick="switchProjTab(${proj.id},'labor',this)">Labor</div>
        <div class="proj-tab" onclick="switchProjTab(${proj.id},'pricing',this)">Pricing Calculator</div>
        <div class="proj-tab" onclick="switchProjTab(${proj.id},'compare',this)">âš– Price Compare</div>
        <div class="proj-tab" onclick="switchProjTab(${proj.id},'notes',this)">Notes</div>
      </div>
      <div class="proj-tab-content active" id="tab-${proj.id}-suppliers">
        <table class="proj-table" id="supplier-table-${proj.id}">
          <thead><tr><th>Supplier Name</th><th>Contact</th><th>Phone / Email</th><th>Lead Time</th><th>Status</th><th></th></tr></thead>
          <tbody>${proj.suppliers.map((s,i)=>supplierRow(proj.id,i,s)).join('')}</tbody>
        </table>
        <button class="add-row-btn" onclick="addSupplierRow(${proj.id})">ï¼‹ Add Supplier</button>
      </div>
      <div class="proj-tab-content" id="tab-${proj.id}-materials">
        <table class="proj-table" id="material-table-${proj.id}">
          <thead><tr><th>Material / Item</th><th>Supplier</th><th>Quantity</th><th>Unit Cost</th><th>Total Cost</th><th></th></tr></thead>
          <tbody>${proj.materials.map((m,i)=>materialRow(proj.id,i,m)).join('')}</tbody>
        </table>
        <button class="add-row-btn" onclick="addMaterialRow(${proj.id})">ï¼‹ Add Material</button>
      </div>
      <div class="proj-tab-content" id="tab-${proj.id}-labor">
        <table class="proj-table" id="labor-table-${proj.id}">
          <thead><tr><th>Task / Operation</th><th>Hours</th><th>Rate ($/hr)</th><th>Total</th><th></th></tr></thead>
          <tbody>${proj.labor.map((l,i)=>laborRow(proj.id,i,l)).join('')}</tbody>
        </table>
        <button class="add-row-btn" onclick="addLaborRow(${proj.id})">ï¼‹ Add Task</button>
      </div>
      <div class="proj-tab-content" id="tab-${proj.id}-pricing">
        <div class="pricing-calc" id="pricing-calc-${proj.id}">${renderPricingCalc(proj)}</div>
      </div>
      <div class="proj-tab-content" id="tab-${proj.id}-compare">
        <div class="price-compare-desc">Enter pricing from each supplier for every cost component â€” product, packaging, and shipping. Winners are automatically identified per category and overall.</div>
        <div id="pc-content-${proj.id}">${renderPriceCompare(proj)}</div>
      </div>
      <div class="proj-tab-content" id="tab-${proj.id}-notes">
        <div style="margin-bottom:10px;font-size:12px;color:var(--muted);">Shared notes visible to both Venture Builder and Production & R&D teams.</div>
        <textarea class="proj-notes" onblur="saveNote(${proj.id},this.value)">${proj.notes}</textarea>
        <div style="display:flex;justify-content:flex-end;margin-top:10px;">
          <button class="btn btn-primary" onclick="saveNoteBtn(${proj.id})">Save Notes</button>
        </div>
      </div>
    </div>`;
  return card;
}

function renderPricingCalc(proj) {
  const matTot = calcMaterialTotal(proj);
  const labTot = calcLaborTotal(proj);
  const oh     = (matTot + labTot) * ((parseFloat(proj.overhead)||0)/100);
  const cogs   = matTot + labTot + oh;
  const margin = parseFloat(proj.targetMargin)||60;
  const price  = calcSuggestedPrice(proj);
  return `
    <div style="margin-bottom:16px;font-size:13px;font-weight:600;color:var(--brown);">Cost Breakdown & Pricing</div>
    <div class="calc-row"><label>Materials Total</label><span class="calc-result">${fmt(matTot)}</span></div>
    <div class="calc-row"><label>Labor Total</label><span class="calc-result">${fmt(labTot)}</span></div>
    <div class="calc-row">
      <label>Overhead % &nbsp;<input class="calc-input" type="number" value="${proj.overhead}" min="0" max="100" oninput="updateOverhead(${proj.id},this.value)" style="width:70px;"></label>
      <span class="calc-result">${fmt(oh)}</span>
    </div>
    <div class="calc-row" style="border-top:2px solid var(--cream-dk);margin-top:4px;padding-top:14px;">
      <label style="font-weight:600;color:var(--body);">Total COGS</label>
      <span class="calc-result" style="font-size:18px;">${fmt(cogs)}</span>
    </div>
    <div class="calc-row">
      <label>Target Margin % &nbsp;<input class="calc-input" type="number" value="${margin}" min="1" max="99" oninput="updateMargin(${proj.id},this.value)" style="width:70px;"></label>
      <span class="calc-result">&nbsp;</span>
    </div>
    <div class="calc-row" style="border-top:2px solid var(--brown);margin-top:4px;padding-top:14px;background:rgba(51,43,30,0.03);border-radius:0 0 6px 6px;padding-left:8px;padding-right:8px;">
      <label style="font-weight:700;color:var(--brown);font-size:14px;">Suggested Retail Price</label>
      <span class="calc-result green" style="font-size:22px;">${fmt(price)}</span>
    </div>
    <div style="margin-top:12px;padding:10px 12px;background:rgba(74,124,89,0.07);border-radius:6px;font-size:12px;color:var(--success);">
      âœ“ At ${fmt(price)} retail, the margin is ${margin}% â€” the Venture Builder team can price confidently from this baseline.
    </div>`;
}

function supplierRow(pid,i,s){return`<tr><td><input type="text" value="${s.name}" placeholder="Supplier name" onchange="updateSupplier(${pid},${i},'name',this.value)"></td><td><input type="text" value="${s.contact}" placeholder="Contact name" onchange="updateSupplier(${pid},${i},'contact',this.value)"></td><td><input type="text" value="${s.phone}" placeholder="Phone or email" onchange="updateSupplier(${pid},${i},'phone',this.value)"></td><td><input type="text" value="${s.leadTime}" placeholder="e.g. 5â€“7 days" onchange="updateSupplier(${pid},${i},'leadTime',this.value)"></td><td><select onchange="updateSupplier(${pid},${i},'status',this.value)"><option ${s.status==='Active'?'selected':''}>Active</option><option ${s.status==='Preferred'?'selected':''}>Preferred</option><option ${s.status==='Backup'?'selected':''}>Backup</option><option ${s.status==='On Hold'?'selected':''}>On Hold</option></select></td><td class="action-cell"><button class="del-btn" onclick="deleteSupplier(${pid},${i})">Ã—</button></td></tr>`;}

function materialRow(pid,i,m){return`<tr><td><input type="text" value="${m.item}" placeholder="Material or item name" onchange="updateMaterial(${pid},${i},'item',this.value)"></td><td><input type="text" value="${m.supplier}" placeholder="Supplier" onchange="updateMaterial(${pid},${i},'supplier',this.value)"></td><td><input type="text" value="${m.qty}" placeholder="Qty" onchange="updateMaterial(${pid},${i},'qty',this.value)"></td><td class="cost-cell"><input type="number" value="${m.unitCost}" min="0" step="0.01" placeholder="0.00" onchange="updateMaterial(${pid},${i},'unitCost',this.value);recalcMaterial(${pid},${i})"></td><td class="cost-cell"><input type="number" value="${m.totalCost}" min="0" step="0.01" placeholder="0.00" onchange="updateMaterial(${pid},${i},'totalCost',this.value);refreshProjectTotals(${pid})"></td><td class="action-cell"><button class="del-btn" onclick="deleteMaterial(${pid},${i})">Ã—</button></td></tr>`;}

function laborRow(pid,i,l){return`<tr><td><input type="text" value="${l.task}" placeholder="Task or operation" onchange="updateLabor(${pid},${i},'task',this.value)"></td><td class="cost-cell"><input type="number" value="${l.hours}" min="0" step="0.25" placeholder="0" onchange="updateLabor(${pid},${i},'hours',this.value);recalcLabor(${pid},${i})"></td><td class="cost-cell"><input type="number" value="${l.rate}" min="0" step="1" placeholder="0" onchange="updateLabor(${pid},${i},'rate',this.value);recalcLabor(${pid},${i})"></td><td class="cost-cell"><input type="number" value="${l.total}" min="0" step="0.01" placeholder="0.00" id="labor-total-${pid}-${i}" readonly style="font-weight:700;color:var(--brown);background:transparent;"></td><td class="action-cell"><button class="del-btn" onclick="deleteLabor(${pid},${i})">Ã—</button></td></tr>`;}

function toggleProject(id){openProjectId=openProjectId===id?null:id;renderProjects();}

function switchProjTab(pid,tabName,el){
  const body=document.querySelector(`#proj-card-${pid} .project-body`);
  body.querySelectorAll('.proj-tab').forEach(t=>t.classList.remove('active'));
  body.querySelectorAll('.proj-tab-content').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById(`tab-${pid}-${tabName}`).classList.add('active');
}

function updateSupplier(pid,i,field,val){const proj=projects.find(p=>p.id===pid);proj.suppliers[i][field]=val;refreshProjectTotals(pid);}
function updateMaterial(pid,i,field,val){const proj=projects.find(p=>p.id===pid);proj.materials[i][field]=(field==='item'||field==='supplier'||field==='qty')?val:parseFloat(val)||0;refreshProjectTotals(pid);}
function recalcMaterial(pid,i){const proj=projects.find(p=>p.id===pid);const m=proj.materials[i];m.totalCost=(parseFloat(m.unitCost)||0)*(parseFloat(m.qty)||1);refreshProjectTotals(pid);const row=document.querySelectorAll(`#material-table-${pid} tbody tr`)[i];if(row)row.querySelectorAll('input')[4].value=m.totalCost.toFixed(2);}
function updateLabor(pid,i,field,val){const proj=projects.find(p=>p.id===pid);proj.labor[i][field]=field==='task'?val:parseFloat(val)||0;}
function recalcLabor(pid,i){const proj=projects.find(p=>p.id===pid);const l=proj.labor[i];l.total=(parseFloat(l.hours)||0)*(parseFloat(l.rate)||0);const ti=document.getElementById(`labor-total-${pid}-${i}`);if(ti)ti.value=l.total.toFixed(2);refreshProjectTotals(pid);}

function refreshProjectTotals(pid){
  const proj=projects.find(p=>p.id===pid);
  const mat=calcMaterialTotal(proj),lab=calcLaborTotal(proj),cogs=calcCOGS(proj),price=calcSuggestedPrice(proj);
  const card=document.getElementById('proj-card-'+pid);if(!card)return;
  const vals=card.querySelectorAll('.cost-summary-val');
  if(vals[0])vals[0].textContent=mat>0?fmt(mat):'â€”';
  if(vals[1])vals[1].textContent=lab>0?fmt(lab):'â€”';
  if(vals[2])vals[2].textContent=cogs>0?fmt(cogs):'â€”';
  if(vals[3])vals[3].textContent=price>0?fmt(price):'â€”';
  const ht=card.querySelectorAll('.project-total');
  if(ht[0])ht[0].textContent=cogs>0?fmt(cogs):'â€”';
  if(ht[1])ht[1].textContent=price>0?fmt(price):'â€”';
  const calcEl=document.getElementById('pricing-calc-'+pid);
  if(calcEl)calcEl.innerHTML=renderPricingCalc(proj);
}

function updateOverhead(pid,val){const proj=projects.find(p=>p.id===pid);proj.overhead=parseFloat(val)||0;refreshProjectTotals(pid);}
function updateMargin(pid,val){const proj=projects.find(p=>p.id===pid);proj.targetMargin=parseFloat(val)||60;refreshProjectTotals(pid);}

function addSupplierRow(pid){const proj=projects.find(p=>p.id===pid);proj.suppliers.push({name:'',contact:'',phone:'',leadTime:'',status:'Active'});const tbody=document.querySelector(`#supplier-table-${pid} tbody`);const i=proj.suppliers.length-1;tbody.insertAdjacentHTML('beforeend',supplierRow(pid,i,proj.suppliers[i]));showToast('Supplier row added.');}
function addMaterialRow(pid){const proj=projects.find(p=>p.id===pid);proj.materials.push({item:'',supplier:'',qty:'',unitCost:0,totalCost:0});const tbody=document.querySelector(`#material-table-${pid} tbody`);const i=proj.materials.length-1;tbody.insertAdjacentHTML('beforeend',materialRow(pid,i,proj.materials[i]));showToast('Material row added.');}
function addLaborRow(pid){const proj=projects.find(p=>p.id===pid);proj.labor.push({task:'',hours:0,rate:0,total:0});const tbody=document.querySelector(`#labor-table-${pid} tbody`);const i=proj.labor.length-1;tbody.insertAdjacentHTML('beforeend',laborRow(pid,i,proj.labor[i]));showToast('Labor task added.');}

function deleteSupplier(pid,i){const proj=projects.find(p=>p.id===pid);proj.suppliers.splice(i,1);document.querySelectorAll(`#supplier-table-${pid} tbody tr`)[i].remove();showToast('Supplier removed.');}
function deleteMaterial(pid,i){const proj=projects.find(p=>p.id===pid);proj.materials.splice(i,1);document.querySelectorAll(`#material-table-${pid} tbody tr`)[i].remove();refreshProjectTotals(pid);showToast('Material removed.');}
function deleteLabor(pid,i){const proj=projects.find(p=>p.id===pid);proj.labor.splice(i,1);document.querySelectorAll(`#labor-table-${pid} tbody tr`)[i].remove();refreshProjectTotals(pid);showToast('Task removed.');}

function saveNote(pid,val){const proj=projects.find(p=>p.id===pid);proj.notes=val;}
function saveNoteBtn(pid){const ta=document.querySelector(`#tab-${pid}-notes textarea`);if(ta)saveNote(pid,ta.value);showToast('âœ“ Notes saved.');}

// â”€â”€ PRICE COMPARE ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderPriceCompare(proj) {
  if (!proj.priceCompare) proj.priceCompare = [];
  const rows = proj.priceCompare;
  const fmt2 = v => v > 0 ? '$' + parseFloat(v).toFixed(2) : 'â€”';

  // Determine per-category winners
  function winnerIdx(field) {
    let best = Infinity, idx = -1;
    rows.forEach((r, i) => {
      const v = parseFloat(r[field]) || 0;
      if (v > 0 && v < best) { best = v; idx = i; }
    });
    return idx;
  }
  const wProd = winnerIdx('product');
  const wPack = winnerIdx('packaging');
  const wShip = winnerIdx('shipping');

  // Overall winner: lowest total
  let overallIdx = -1, overallMin = Infinity;
  rows.forEach((r, i) => {
    const tot = (parseFloat(r.product)||0) + (parseFloat(r.packaging)||0) + (parseFloat(r.shipping)||0);
    if (tot > 0 && tot < overallMin) { overallMin = tot; overallIdx = i; }
  });

  // Max total for savings calc
  let maxTotal = 0;
  rows.forEach(r => {
    const tot = (parseFloat(r.product)||0) + (parseFloat(r.packaging)||0) + (parseFloat(r.shipping)||0);
    if (tot > maxTotal) maxTotal = tot;
  });
  const savings = overallIdx >= 0 && maxTotal > overallMin ? maxTotal - overallMin : 0;

  function winBadge(i, field) {
    const widx = field==='product'?wProd:field==='packaging'?wPack:wShip;
    if (rows.length < 2) return `<span class="winner-badge none">â€”</span>`;
    const v = parseFloat(rows[i][field])||0;
    if (v === 0) return `<span class="winner-badge none">No data</span>`;
    if (i === widx) return `<span class="winner-badge gold">ðŸ† Winner</span>`;
    return `<span class="winner-badge none">â€”</span>`;
  }

  const tableRows = rows.map((r, i) => `
    <tr>
      <td><input type="text" value="${r.supplier||''}" placeholder="Supplier name" onchange="updatePC(${proj.id},${i},'supplier',this.value)"></td>
      <td class="pc-num"><input type="number" value="${r.product||''}" min="0" step="0.01" placeholder="0.00" onchange="updatePC(${proj.id},${i},'product',this.value)"></td>
      <td class="pc-winner-cell">${winBadge(i,'product')}</td>
      <td class="pc-num"><input type="number" value="${r.packaging||''}" min="0" step="0.01" placeholder="0.00" onchange="updatePC(${proj.id},${i},'packaging',this.value)"></td>
      <td class="pc-winner-cell">${winBadge(i,'packaging')}</td>
      <td class="pc-num"><input type="number" value="${r.shipping||''}" min="0" step="0.01" placeholder="0.00" onchange="updatePC(${proj.id},${i},'shipping',this.value)"></td>
      <td class="pc-winner-cell">${winBadge(i,'shipping')}</td>
      <td class="pc-num" style="font-weight:700;color:var(--brown);text-align:right;padding:10px 12px;">${fmt2((parseFloat(r.product)||0)+(parseFloat(r.packaging)||0)+(parseFloat(r.shipping)||0))}</td>
      <td><input type="text" value="${r.notes||''}" placeholder="Notesâ€¦" onchange="updatePC(${proj.id},${i},'notes',this.value)"></td>
      <td class="pc-action"><button class="del-btn" onclick="deletePC(${proj.id},${i})">Ã—</button></td>
    </tr>`).join('');

  // Summary boxes
  const cats = ['product','packaging','shipping'];
  const catLabels = ['Product / Manufacturing','Packaging','Shipping / Freight'];
  const catIcons  = ['âš™','ðŸ“¦','ðŸšš'];
  const summaryBoxes = cats.map((c,ci) => {
    const wi = c==='product'?wProd:c==='packaging'?wPack:wShip;
    const name = wi>=0 ? rows[wi].supplier||'â€”' : 'â€”';
    const val  = wi>=0 ? fmt2(parseFloat(rows[wi][c])||0) : 'â€”';
    return `<div class="pc-summary-item">
      <div class="pc-summary-cat">${catIcons[ci]} ${catLabels[ci]}</div>
      <div class="pc-summary-name">${name}</div>
      <div class="pc-summary-val ${wi<0?'empty':''}">${val}</div>
    </div>`;
  }).join('');

  const overallName = overallIdx>=0 ? rows[overallIdx].supplier||'â€”' : 'No data yet';
  const overallCost = overallIdx>=0 ? '$'+overallMin.toFixed(2) : 'â€”';
  const savingsText = savings>0 ? `Saves $${savings.toFixed(2)} vs. most expensive option` : overallIdx>=0 ? 'Only one supplier with full data' : 'Add at least 2 suppliers to compare';

  return `
    <div class="pc-category">
      <div class="pc-category-title">
        <span class="pc-category-icon">âš–</span>
        Side-by-Side Comparison
      </div>
      <div style="overflow-x:auto;">
        <table class="price-compare-table">
          <thead>
            <tr>
              <th>Supplier</th>
              <th>Product Cost</th><th>Winner</th>
              <th>Packaging</th><th>Winner</th>
              <th>Shipping</th><th>Winner</th>
              <th>Total</th>
              <th>Notes</th>
              <th></th>
            </tr>
          </thead>
          <tbody>${tableRows}</tbody>
        </table>
      </div>
      <button class="add-row-btn" onclick="addPC(${proj.id})">ï¼‹ Add Supplier for Comparison</button>
    </div>
    <div class="pc-summary">
      <div class="pc-summary-title">ðŸ† Category Winners</div>
      <div class="pc-summary-grid">${summaryBoxes}
        <div class="pc-summary-item" style="border-color:rgba(74,124,89,0.3);background:rgba(74,124,89,0.04);">
          <div class="pc-summary-cat">ðŸ’° Lowest Total</div>
          <div class="pc-summary-name">${overallName}</div>
          <div class="pc-summary-val ${overallIdx<0?'empty':''}">${overallCost}</div>
        </div>
      </div>
      <div class="pc-overall-winner">
        <div>
          <div class="pc-overall-label">Overall Recommended Supplier</div>
          <div class="pc-overall-name">${overallName}</div>
          <div class="pc-overall-savings ${savings===0?'none':''}">${savingsText}</div>
        </div>
        <div style="text-align:right;">
          <div class="pc-overall-label">Best Total Cost</div>
          <div class="pc-overall-cost">${overallCost}</div>
        </div>
      </div>
    </div>`;
}

function updatePC(pid, i, field, val) {
  const proj = projects.find(p => p.id === pid);
  if (!proj.priceCompare[i]) return;
  proj.priceCompare[i][field] = (field === 'supplier' || field === 'notes') ? val : parseFloat(val)||0;
  refreshPC(pid);
}

function addPC(pid) {
  const proj = projects.find(p => p.id === pid);
  if (!proj.priceCompare) proj.priceCompare = [];
  proj.priceCompare.push({ supplier: '', product: 0, packaging: 0, shipping: 0, notes: '' });
  refreshPC(pid);
  showToast('Supplier row added to comparison.');
}

function deletePC(pid, i) {
  const proj = projects.find(p => p.id === pid);
  proj.priceCompare.splice(i, 1);
  refreshPC(pid);
  showToast('Supplier removed from comparison.');
}

function refreshPC(pid) {
  const proj = projects.find(p => p.id === pid);
  const el = document.getElementById('pc-content-' + pid);
  if (el) el.innerHTML = renderPriceCompare(proj);
}

function openNewProjectModal(){document.getElementById('new-project-modal').classList.add('open');}
function closeNewProjectModal(){document.getElementById('new-project-modal').classList.remove('open');}
function closeNewProjectModalOutside(e){if(e.target.id==='new-project-modal')closeNewProjectModal();}

function createProject(){
  const name=document.getElementById('np-name').value.trim();
  const brand=document.getElementById('np-brand').value;
  const shop=document.getElementById('np-shop').value;
  const stage=document.getElementById('np-stage').value;
  if(!name||!brand||!shop){showToast('Please fill in Name, Brand, and Shop.');return;}
  const newProj={id:Date.now(),name,brand,shop,stage,color:dotColors[projects.length%dotColors.length],notes:'',suppliers:[],materials:[],labor:[],overhead:10,targetMargin:60,priceCompare:[]};
  projects.push(newProj);
  openProjectId=newProj.id;
  closeNewProjectModal();
  document.getElementById('np-name').value='';
  document.getElementById('np-brand').value='';
  document.getElementById('np-shop').value='';
  renderProjects();
  showToast('âœ“ Project created. Add suppliers, materials, and labor below.');
}


// roundRect polyfill for older browsers
if (!CanvasRenderingContext2D.prototype.roundRect) {
  CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
    if (w < 2 * r) r = w / 2;
    if (h < 2 * r) r = h / 2;
    this.beginPath();
    this.moveTo(x + r, y);
    this.arcTo(x + w, y, x + w, y + h, r);
    this.arcTo(x + w, y + h, x, y + h, r);
    this.arcTo(x, y + h, x, y, r);
    this.arcTo(x, y, x + w, y, r);
    this.closePath();
    return this;
  };
}
// â”€â”€ OPS PERFORMANCE METRICS ENGINE v2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA ARCHITECTURE NOTE:
// This data layer is designed to be replaced by a live ERP/MES API feed.
// Each product has a `dataSource` property for future endpoint mapping.
// The `opsData` object mirrors a typical MES schema with hourly â†’ yearly rollups.
// To connect: replace `generateHistoricalData()` calls with API fetch() calls
// using the same schema, then call renderOpsMetrics() on success.

let opsView    = 'daily';
let opsShop    = 'both';
let opsMetric  = 'units';
let opsHistoryProduct = 'all';

// Product definitions â€” dataSource will point to ERP/MES endpoint when connected
const OPS_PRODUCTS = [
  { id: 'wall-art',  name: 'Metal Wall Art',   shop: 'metal', icon: 'ðŸ–¼', color: '#332b1e',
    dataSource: '/api/metal-fab/wall-art',
    unitLabel: 'panels', revenuePerUnit: 160,
    targets: { hourly:3, daily:24, weekly:168, monthly:720, quarterly:2160 } },
  { id: 'furniture', name: 'Metal Furniture',  shop: 'metal', icon: 'ðŸª‘', color: '#4a3d2b',
    dataSource: '/api/metal-fab/furniture',
    unitLabel: 'pieces', revenuePerUnit: 600,
    targets: { hourly:1, daily:8, weekly:56, monthly:240, quarterly:720 } },
  { id: 'wallpaper', name: 'Wallpaper',         shop: 'print', icon: 'ðŸ§±', color: '#3d3d3d',
    dataSource: '/api/print-shop/wallpaper',
    unitLabel: 'rolls', revenuePerUnit: 40,
    targets: { hourly:30, daily:240, weekly:1680, monthly:7200, quarterly:21600 } },
  { id: 'wrapping',  name: 'Wrapping Paper',    shop: 'print', icon: 'ðŸŽ', color: '#6b5a42',
    dataSource: '/api/print-shop/wrapping',
    unitLabel: 'rolls', revenuePerUnit: 15,
    targets: { hourly:50, daily:400, weekly:2800, monthly:12000, quarterly:36000 } },
  { id: 'samples',   name: 'Samples',           shop: 'print', icon: 'ðŸ—‚', color: '#9e9790',
    dataSource: '/api/print-shop/samples',
    unitLabel: 'packs', revenuePerUnit: 0,
    targets: { hourly:7, daily:56, weekly:392, monthly:1680, quarterly:5040 } },
  { id: 'fabric',    name: 'Fabric',            shop: 'print', icon: 'ðŸ§µ', color: '#b5762a',
    dataSource: '/api/print-shop/fabric',
    unitLabel: 'yards', revenuePerUnit: 38,
    targets: { hourly:6, daily:48, weekly:336, monthly:1440, quarterly:4320 } },
];

// Seeded random for consistent demo data
function seededRand(seed) {
  let s = seed;
  return function() {
    s = (s * 16807 + 0) % 2147483647;
    return (s - 1) / 2147483646;
  };
}

// Generate a full year of historical records per product
function generateHistoricalData() {
  const records = [];
  const now = new Date(2025, 2, 31); // March 31 2025 as "today"
  const rand = seededRand(42);

  OPS_PRODUCTS.forEach(prod => {
    // Generate 365 daily records
    for (let d = 364; d >= 0; d--) {
      const date = new Date(now);
      date.setDate(date.getDate() - d);
      const dayOfWeek = date.getDay();
      const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
      const seasonFactor = 1 + 0.15 * Math.sin((date.getMonth() / 12) * 2 * Math.PI);
      const trendFactor  = 1 + (0.08 * (364 - d) / 364); // gentle upward trend
      const dailyTarget  = prod.targets.daily;
      const efficiency   = isWeekend ? 0.6 : (0.75 + rand() * 0.3);
      const units        = Math.round(dailyTarget * efficiency * seasonFactor * trendFactor);
      const defects      = Math.round(units * (0.005 + rand() * 0.02));
      const onTime       = Math.round(88 + rand() * 12);
      const leadTime     = parseFloat((2.5 + rand() * 4).toFixed(1));
      const laborHrs     = parseFloat((0.2 + rand() * 0.8).toFixed(2));
      const revenue      = units * prod.revenuePerUnit;

      // Generate 8 hourly breakdowns for this day
      const hours = [];
      let remaining = units;
      for (let h = 0; h < 8; h++) {
        const share = h < 7 ? Math.round(units * (0.08 + rand() * 0.08)) : remaining;
        remaining -= share;
        hours.push({ hour: 7 + h, units: Math.max(0, share) });
      }

      records.push({
        productId: prod.id,
        shop: prod.shop,
        date,
        year:  date.getFullYear(),
        month: date.getMonth() + 1,
        week:  getWeekNum(date),
        quarter: Math.ceil((date.getMonth() + 1) / 3),
        dayOfWeek,
        units, defects, onTime, leadTime, laborHrs, revenue,
        target: dailyTarget,
        hours,
      });
    }
  });
  return records;
}

function getWeekNum(d) {
  const onejan = new Date(d.getFullYear(), 0, 1);
  return Math.ceil((((d - onejan) / 86400000) + onejan.getDay() + 1) / 7);
}

const OPS_RECORDS = generateHistoricalData();

// â”€â”€ AGGREGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function aggregateRecords(view, shopFilter) {
  const filtered = OPS_RECORDS.filter(r => shopFilter === 'both' || r.shop === shopFilter);
  const buckets = {};

  filtered.forEach(r => {
    let key;
    if      (view === 'hourly')    { key = `Today H${String(r.hours[0]?.hour||7).padStart(2,'0')}`; /* use last day */ }
    else if (view === 'daily')     { key = r.date.toISOString().slice(0,10); }
    else if (view === 'weekly')    { key = `${r.year}-W${String(r.week).padStart(2,'0')}`; }
    else if (view === 'monthly')   { key = `${r.year}-${String(r.month).padStart(2,'0')}`; }
    else if (view === 'quarterly') { key = `${r.year}-Q${r.quarter}`; }
    else if (view === 'yoy')       { key = String(r.year); }

    if (!buckets[key]) buckets[key] = { label: key, units:0, revenue:0, defects:0, laborHrs:0, onTime:0, leadTime:0, target:0, count:0 };
    buckets[key].units    += r.units;
    buckets[key].revenue  += r.revenue;
    buckets[key].defects  += r.defects;
    buckets[key].laborHrs += r.laborHrs;
    buckets[key].onTime   += r.onTime;
    buckets[key].leadTime += r.leadTime;
    buckets[key].target   += r.target;
    buckets[key].count    += 1;
  });

  // Average rate metrics
  Object.values(buckets).forEach(b => {
    b.onTime   = Math.round(b.onTime   / b.count);
    b.leadTime = parseFloat((b.leadTime / b.count).toFixed(1));
    b.laborHrs = parseFloat((b.laborHrs / b.count).toFixed(2));
  });

  // Sort and limit to last N periods
  const sorted = Object.values(buckets).sort((a,b) => a.label > b.label ? 1 : -1);
  const limits = { hourly:8, daily:30, weekly:12, monthly:12, quarterly:8, yoy:2 };
  return sorted.slice(-limits[view]);
}

function aggregateByProduct(view, shopFilter) {
  const result = {};
  OPS_PRODUCTS.forEach(p => {
    if (shopFilter !== 'both' && p.shop !== shopFilter) return;
    const recs = OPS_RECORDS.filter(r => r.productId === p.id);
    const limitDays = { hourly:1, daily:1, weekly:7, monthly:30, quarterly:90, yoy:365 };
    const cutoff = new Date(2025, 2, 31);
    cutoff.setDate(cutoff.getDate() - limitDays[view]);
    const recent = recs.filter(r => r.date >= cutoff);
    const units   = recent.reduce((s,r) => s+r.units, 0);
    const revenue = recent.reduce((s,r) => s+r.revenue, 0);
    const defects = recent.reduce((s,r) => s+r.defects, 0);
    const target  = recent.reduce((s,r) => s+r.target, 0);
    const onTime  = recent.length ? Math.round(recent.reduce((s,r)=>s+r.onTime,0)/recent.length) : 0;
    const leadTime = recent.length ? parseFloat((recent.reduce((s,r)=>s+r.leadTime,0)/recent.length).toFixed(1)) : 0;
    const laborHrs = recent.length ? parseFloat((recent.reduce((s,r)=>s+r.laborHrs,0)/recent.length).toFixed(2)) : 0;
    result[p.id] = { ...p, units, revenue, defects, target, onTime, leadTime, laborHrs };
  });
  return result;
}

// â”€â”€ CANVAS CHARTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawLineChart(canvasId, buckets, metric, label) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth || 900;
  const H = 220;
  canvas.width = W;
  canvas.height = H;
  ctx.clearRect(0, 0, W, H);

  const values = buckets.map(b => b[metric] || 0);
  const maxV = Math.max(...values) * 1.15 || 1;
  const minV = 0;
  const padL = 58, padR = 16, padT = 16, padB = 38;
  const chartW = W - padL - padR;
  const chartH = H - padT - padB;

  // Grid lines
  ctx.strokeStyle = '#e8e2d8';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const y = padT + chartH - (i / 4) * chartH;
    ctx.beginPath(); ctx.moveTo(padL, y); ctx.lineTo(W - padR, y); ctx.stroke();
    ctx.fillStyle = '#9e9790';
    ctx.font = '10px DM Sans, sans-serif';
    ctx.textAlign = 'right';
    const v = Math.round((minV + (i/4) * (maxV - minV)));
    ctx.fillText(metric === 'revenue' ? '$' + v.toLocaleString() : v.toLocaleString(), padL - 6, y + 3);
  }

  // Area fill
  if (values.length > 1) {
    const gradient = ctx.createLinearGradient(0, padT, 0, padT + chartH);
    gradient.addColorStop(0, 'rgba(51,43,30,0.12)');
    gradient.addColorStop(1, 'rgba(51,43,30,0)');
    ctx.beginPath();
    values.forEach((v, i) => {
      const x = padL + (i / (values.length - 1)) * chartW;
      const y = padT + chartH - ((v - minV) / (maxV - minV)) * chartH;
      i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    });
    ctx.lineTo(padL + chartW, padT + chartH);
    ctx.lineTo(padL, padT + chartH);
    ctx.closePath();
    ctx.fillStyle = gradient;
    ctx.fill();

    // Line
    ctx.beginPath();
    ctx.strokeStyle = '#332b1e';
    ctx.lineWidth = 2.5;
    ctx.lineJoin = 'round';
    values.forEach((v, i) => {
      const x = padL + (i / (values.length - 1)) * chartW;
      const y = padT + chartH - ((v - minV) / (maxV - minV)) * chartH;
      i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    });
    ctx.stroke();

    // Dots
    values.forEach((v, i) => {
      const x = padL + (i / (values.length - 1)) * chartW;
      const y = padT + chartH - ((v - minV) / (maxV - minV)) * chartH;
      ctx.beginPath();
      ctx.arc(x, y, 3.5, 0, Math.PI * 2);
      ctx.fillStyle = '#332b1e';
      ctx.fill();
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 1.5;
      ctx.stroke();
    });
  }

  // X labels
  ctx.fillStyle = '#9e9790';
  ctx.font = '10px DM Sans, sans-serif';
  ctx.textAlign = 'center';
  const step = Math.max(1, Math.floor(buckets.length / 8));
  buckets.forEach((b, i) => {
    if (i % step === 0 || i === buckets.length - 1) {
      const x = padL + (values.length > 1 ? (i / (values.length - 1)) * chartW : chartW / 2);
      ctx.fillText(b.label.slice(-7), x, H - padB + 14);
    }
  });
}

function drawBarChart(canvasId, byProduct) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth || 420;
  const H = 220;
  canvas.width = W;
  canvas.height = H;
  ctx.clearRect(0, 0, W, H);

  const products = Object.values(byProduct);
  if (!products.length) return;
  const maxV = Math.max(...products.map(p => p.units)) * 1.15 || 1;
  const padL = 90, padR = 16, padT = 16, padB = 16;
  const chartW = W - padL - padR;
  const chartH = H - padT - padB;
  const barH = Math.min(28, (chartH / products.length) - 6);

  products.forEach((p, i) => {
    const y = padT + i * (chartH / products.length) + (chartH / products.length - barH) / 2;
    const barW = (p.units / maxV) * chartW;
    const targetW = (p.target / maxV) * chartW;

    // Target bar (ghost)
    ctx.fillStyle = '#ede7de';
    ctx.beginPath();
    ctx.roundRect(padL, y, targetW, barH, 4);
    ctx.fill();

    // Actual bar
    ctx.fillStyle = p.color || '#332b1e';
    ctx.globalAlpha = 0.85;
    ctx.beginPath();
    ctx.roundRect(padL, y + 3, Math.max(4, barW), barH - 6, 3);
    ctx.fill();
    ctx.globalAlpha = 1;

    // Label
    ctx.fillStyle = '#5a5a5a';
    ctx.font = '11px DM Sans, sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText(p.icon + ' ' + p.name, padL - 6, y + barH / 2 + 4);

    // Value
    ctx.fillStyle = '#332b1e';
    ctx.font = 'bold 11px DM Sans, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText(p.units.toLocaleString(), padL + barW + 6, y + barH / 2 + 4);
  });
}

// â”€â”€ RENDER FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setOpsView(v, btn) {
  opsView = v;
  document.querySelectorAll('.ops-view-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderOpsMetrics();
}

function setOpsShop(s, btn) {
  opsShop = s;
  document.querySelectorAll('.ops-filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderOpsMetrics();
}

function setOpsMetric(v) {
  opsMetric = v;
  renderOpsMetrics();
}

function setHistoryProduct(v) {
  opsHistoryProduct = v;
  renderHistoryTable();
}

function fmtNum(v) { return Math.round(v).toLocaleString(); }
function fmtRev(v) { return v > 0 ? '$' + Math.round(v).toLocaleString() : 'N/A'; }
function fmtPct(v) { return v + '%'; }

function renderOpsMetrics() {
  const buckets   = aggregateRecords(opsView, opsShop);
  const byProduct = aggregateByProduct(opsView, opsShop);
  const products  = Object.values(byProduct);
  const current   = buckets[buckets.length - 1] || {};
  const previous  = buckets[buckets.length - 2] || {};

  // â”€â”€ KPI Strip â”€â”€
  function delta(cur, prev) {
    if (!prev || prev === 0) return { cls: 'neutral', txt: 'â€”' };
    const d = ((cur - prev) / prev * 100).toFixed(1);
    return { cls: d >= 0 ? 'up' : 'down', txt: (d >= 0 ? 'â–²' : 'â–¼') + ' ' + Math.abs(d) + '%' };
  }
  const totalUnits   = products.reduce((s,p) => s+p.units, 0);
  const totalRev     = products.reduce((s,p) => s+p.revenue, 0);
  const avgOnTime    = products.length ? Math.round(products.reduce((s,p)=>s+p.onTime,0)/products.length) : 0;
  const avgLead      = products.length ? parseFloat((products.reduce((s,p)=>s+p.leadTime,0)/products.length).toFixed(1)) : 0;
  const totalDefects = products.reduce((s,p)=>s+p.defects, 0);
  const avgLabor     = products.length ? parseFloat((products.reduce((s,p)=>s+p.laborHrs,0)/products.length).toFixed(2)) : 0;

  const dUnits = delta(current.units||0, previous.units||0);
  const dRev   = delta(current.revenue||0, previous.revenue||0);

  document.getElementById('ops-kpi-strip').innerHTML = `
    <div class="ops-kpi-card k1"><div class="ops-kpi-label">Units Produced</div><div class="ops-kpi-val">${fmtNum(totalUnits)}</div><div class="ops-kpi-delta ${dUnits.cls}">${dUnits.txt} vs prev period</div></div>
    <div class="ops-kpi-card k2"><div class="ops-kpi-label">Revenue Output</div><div class="ops-kpi-val" style="font-size:20px;">${fmtRev(totalRev)}</div><div class="ops-kpi-delta ${dRev.cls}">${dRev.txt} vs prev period</div></div>
    <div class="ops-kpi-card k3"><div class="ops-kpi-label">On-Time Rate</div><div class="ops-kpi-val">${fmtPct(avgOnTime)}</div><div class="ops-kpi-delta ${avgOnTime>=95?'up':avgOnTime>=88?'neutral':'down'}">${avgOnTime>=95?'âœ“ Excellent':avgOnTime>=88?'â‰ˆ Acceptable':'âš  Below target'}</div></div>
    <div class="ops-kpi-card k4"><div class="ops-kpi-label">Avg Lead Time</div><div class="ops-kpi-val">${avgLead}d</div><div class="ops-kpi-delta neutral">Order â†’ Ship</div></div>
    <div class="ops-kpi-card k5"><div class="ops-kpi-label">Total Defects</div><div class="ops-kpi-val">${fmtNum(totalDefects)}</div><div class="ops-kpi-delta ${totalDefects<20?'up':'down'}">${totalDefects<20?'Low defect rate':'Monitor closely'}</div></div>
    <div class="ops-kpi-card k6"><div class="ops-kpi-label">Avg Labor Hrs/Unit</div><div class="ops-kpi-val">${avgLabor}h</div><div class="ops-kpi-delta neutral">All products avg</div></div>
  `;

  // â”€â”€ Chart subtitles â”€â”€
  const viewLabels = { hourly:'Today by hour', daily:'Last 30 days', weekly:'Last 12 weeks', monthly:'Last 12 months', quarterly:'Last 8 quarters', yoy:'Year over year' };
  document.getElementById('ops-trend-sub').textContent = viewLabels[opsView];
  document.getElementById('ops-bar-sub').textContent   = viewLabels[opsView];

  // â”€â”€ Line chart â”€â”€
  setTimeout(() => {
    drawLineChart('ops-line-canvas', buckets, opsMetric, opsMetric);
    drawBarChart('ops-bar-canvas', byProduct);
  }, 50);

  // â”€â”€ Target vs Actual â”€â”€
  const tvaHtml = products.map(p => {
    const pct = p.target > 0 ? Math.round((p.units / p.target) * 100) : 0;
    const cls = pct >= 90 ? 'good' : pct >= 70 ? 'warn' : 'bad';
    const barColor = pct >= 90 ? 'var(--success)' : pct >= 70 ? 'var(--warning)' : '#c0392b';
    const actualW  = Math.min(pct, 100);
    return `<div class="ops-tva-row">
      <div class="ops-tva-label" title="${p.name}">${p.icon} ${p.name}</div>
      <div class="ops-tva-track">
        <div class="ops-tva-target" style="width:100%"></div>
        <div class="ops-tva-actual" style="width:${actualW}%;background:${barColor}"></div>
      </div>
      <div class="ops-tva-pct ${cls}">${pct}%</div>
    </div>`;
  }).join('');
  document.getElementById('ops-target-actual').innerHTML = `<div style="padding:4px 0;">${tvaHtml}</div>`;

  // â”€â”€ Deep metrics grid â”€â”€
  const metalProds = products.filter(p => p.shop === 'metal');
  const printProds = products.filter(p => p.shop === 'print');

  function shopCard(prods, title, icon, cls) {
    if (!prods.length) return '';
    const totUnits = prods.reduce((s,p)=>s+p.units,0);
    const totRev   = prods.reduce((s,p)=>s+p.revenue,0);
    const totDef   = prods.reduce((s,p)=>s+p.defects,0);
    const avgOT    = Math.round(prods.reduce((s,p)=>s+p.onTime,0)/prods.length);
    const avgLT    = parseFloat((prods.reduce((s,p)=>s+p.leadTime,0)/prods.length).toFixed(1));
    const defRate  = totUnits > 0 ? ((totDef/totUnits)*100).toFixed(2) : '0.00';
    return `<div class="ops-deep-card">
      <div class="ops-deep-title">${icon} ${title}</div>
      ${prods.map(p=>`<div class="ops-deep-row"><span class="ops-deep-label">${p.icon} ${p.name}</span><span class="ops-deep-val accent">${fmtNum(p.units)} ${p.unitLabel}</span></div>`).join('')}
      <div class="ops-deep-row" style="margin-top:4px;border-top:2px solid var(--cream-dk);padding-top:8px;"><span class="ops-deep-label">Shop Total</span><span class="ops-deep-val accent" style="font-size:18px;">${fmtNum(totUnits)}</span></div>
      <div class="ops-deep-row"><span class="ops-deep-label">Revenue</span><span class="ops-deep-val good">${fmtRev(totRev)}</span></div>
      <div class="ops-deep-row"><span class="ops-deep-label">Defect Rate</span><span class="ops-deep-val ${parseFloat(defRate)<1.5?'good':'warn'}">${defRate}%</span></div>
      <div class="ops-deep-row"><span class="ops-deep-label">On-Time Rate</span><span class="ops-deep-val ${avgOT>=95?'good':avgOT>=88?'':'warn'}">${avgOT}%</span></div>
      <div class="ops-deep-row"><span class="ops-deep-label">Avg Lead Time</span><span class="ops-deep-val">${avgLT} days</span></div>
    </div>`;
  }

  // Median lead time card
  const allLeads = OPS_RECORDS
    .filter(r => opsShop === 'both' || r.shop === opsShop)
    .map(r => r.leadTime).sort((a,b)=>a-b);
  const medLead = allLeads.length ? allLeads[Math.floor(allLeads.length/2)] : 0;
  const avgLeadAll = allLeads.length ? parseFloat((allLeads.reduce((s,v)=>s+v,0)/allLeads.length).toFixed(1)) : 0;
  const minLead = allLeads.length ? allLeads[0] : 0;
  const maxLead = allLeads.length ? allLeads[allLeads.length-1] : 0;

  const leadCard = `<div class="ops-deep-card">
    <div class="ops-deep-title">ðŸ“¦ Order â†’ Ship Lead Time</div>
    <div class="ops-deep-row"><span class="ops-deep-label">Median Lead Time</span><span class="ops-deep-val accent">${medLead} days</span></div>
    <div class="ops-deep-row"><span class="ops-deep-label">Average Lead Time</span><span class="ops-deep-val accent">${avgLeadAll} days</span></div>
    <div class="ops-deep-row"><span class="ops-deep-label">Fastest</span><span class="ops-deep-val good">${minLead} days</span></div>
    <div class="ops-deep-row"><span class="ops-deep-label">Slowest</span><span class="ops-deep-val warn">${maxLead} days</span></div>
    <div class="ops-deep-row"><span class="ops-deep-label">On-Time Target</span><span class="ops-deep-val">â‰¤ 5 days</span></div>
    <div class="ops-deep-row"><span class="ops-deep-label">Pct Within Target</span><span class="ops-deep-val good">${Math.round(allLeads.filter(l=>l<=5).length/allLeads.length*100)}%</span></div>
  </div>`;

  document.getElementById('ops-metrics-deep').innerHTML =
    shopCard(metalProds, 'Metal Fab Shop', 'âš™', 'metal') +
    shopCard(printProds, 'Print Shop', 'ðŸ–¨', 'print') +
    leadCard;

  renderHistoryTable();
}

function renderHistoryTable() {
  const limitDays = { hourly:1, daily:7, weekly:30, monthly:90, quarterly:180, yoy:365 };
  const cutoff = new Date(2025, 2, 31);
  cutoff.setDate(cutoff.getDate() - (limitDays[opsView] || 30));

  let recs = OPS_RECORDS.filter(r => {
    if (r.date < cutoff) return false;
    if (opsShop !== 'both' && r.shop !== opsShop) return false;
    if (opsHistoryProduct !== 'all' && r.productId !== opsHistoryProduct) return false;
    return true;
  });

  // Sort newest first, limit to 100 rows
  recs = recs.sort((a,b) => b.date - a.date).slice(0, 100);

  const prodMap = {};
  OPS_PRODUCTS.forEach(p => prodMap[p.id] = p);

  const rows = recs.map(r => {
    const p = prodMap[r.productId];
    const pct = r.target > 0 ? Math.round((r.units / r.target) * 100) : 0;
    const pctCls = pct >= 90 ? 'good' : pct >= 70 ? 'warn' : 'bad';
    const shopCls = r.shop;
    return `<tr>
      <td>${r.date.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}</td>
      <td>${p ? p.icon + ' ' + p.name : r.productId}</td>
      <td><span class="ops-shop-tag ${shopCls}">${r.shop === 'metal' ? 'âš™ Metal Fab' : 'ðŸ–¨ Print Shop'}</span></td>
      <td>${fmtNum(r.units)}</td>
      <td>${fmtNum(r.target)}</td>
      <td><span class="ops-pct-pill ${pctCls}">${pct}%</span></td>
      <td>${fmtRev(r.revenue)}</td>
      <td>${r.defects}</td>
      <td><span class="ops-pct-pill ${r.onTime>=95?'good':r.onTime>=88?'warn':'bad'}">${r.onTime}%</span></td>
      <td>${r.leadTime}d</td>
      <td>${r.laborHrs}h</td>
    </tr>`;
  }).join('');

  document.getElementById('ops-history-tbody').innerHTML = rows || '<tr><td colspan="11" style="text-align:center;padding:20px;color:var(--muted);">No records for selected filters.</td></tr>';
}

// Initialize on load
window.addEventListener('load', () => {
  document.querySelectorAll('.stagger-bar').forEach((bar, i) => {
    setTimeout(() => { bar.style.height = bar.dataset.h + 'px'; }, i * 100);
  });
  renderProjects();
  renderOpsMetrics();
});
// Redraw charts on window resize
window.addEventListener('resize', () => {
  if (document.getElementById('page-opsmetrics').classList.contains('active')) {
    renderOpsMetrics();
  }
});

</script>
</body>
</html>
